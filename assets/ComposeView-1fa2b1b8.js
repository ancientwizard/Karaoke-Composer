import{d as te,r as C,c as R,a as v,b as e,t as m,F as K,e as oe,w,v as B,f as se,g as S,h as P,i as g,n as U,j as L,o as b,_ as le,k as ue,l as ce,m as me,p as W,q as be,s as pe,u as ve,x as fe,y as ge}from"./index-d671fee0.js";import{a as I}from"./audioStorageService-d4372df5.js";import{p as Z}from"./lyricsParser-c2c86582.js";class ee{static toLRC(p){var x;const l=[];l.push("[version:2.1]"),l.push("[syllable_timing:true]"),p.name&&l.push("[ti:".concat(this.escapeMetadata(p.name),"]")),p.artist&&l.push("[au:".concat(this.escapeMetadata(p.artist),"]")),l.push("[creator:Karaoke Composer]");const d=this.calculateDuration(p.lyrics);d>0&&l.push("[duration:".concat(this.formatTimestamp(d),"]")),l.push("");let u=0;for(const n of p.lyrics){if(n.type&&n.type!=="lyrics"&&n.type!=="caption")continue;if(n.type==="caption"){const y=((x=n.metadata)==null?void 0:x.caption)||n.text.replace(/^\[@CAPTION:\s*/,"").replace(/\]$/,"");l.push("#[line:".concat(u,":caption:").concat(this.escapeMetadata(y),"]"));continue}if(!n.words||n.words.length===0)continue;const h=n.words[0].startTime||0,f=this.formatLine(n);l.push("[".concat(this.formatTimestamp(h),"]").concat(f)),u++}return l.join("\n")+"\n"}static formatLine(p){if(!p.words)return p.text;const l=[];for(const d of p.words){if(!d.syllables||d.syllables.length===0)d.startTime!==void 0?l.push("<".concat(this.formatTimestamp(d.startTime),">").concat(d.word)):l.push(d.word);else for(const u of d.syllables)u.startTime!==void 0?l.push("<".concat(this.formatTimestamp(u.startTime),">").concat(u.syllable)):l.push(u.syllable);l.push(" ")}return l.join("").trim()}static formatTimestamp(p){const l=p/1e3,d=Math.floor(l/60),u=l%60;return"".concat(String(d).padStart(2,"0"),":").concat(u.toFixed(2).padStart(5,"0"))}static escapeMetadata(p){return p.replace(/[\r\n]/g," ").replace(/[[\]]/g,"")}static calculateDuration(p){let l=0;for(const d of p)if(d.words)for(const u of d.words)u.endTime!==void 0&&u.endTime>l&&(l=u.endTime);return l}}function ye(j){let p=0,l=0,d=0,u=0;const x=j.lyrics.filter(f=>f.startTime!==void 0).length;for(const f of j.lyrics)for(const y of f.words){p++,y.startTime!==void 0&&d++;for(const r of y.syllables)l++,r.startTime!==void 0&&u++}const n=j.audioFile.duration||0,h=l>0?Math.round(u/l*100):0;return{totalLines:j.lyrics.length,totalWords:p,totalSyllables:l,timedLines:x,timedWords:d,timedSyllables:u,duration:n,completionPercentage:h}}const ke={class:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable"},xe={class:"modal-content"},we={class:"modal-body"},he={class:"alert alert-info"},Ce={class:"mb-1"},$e={class:"mb-2 text-muted"},Se={class:"d-flex gap-3 small"},Fe={class:"nav nav-tabs mb-3",role:"tablist"},je=["onClick"],De={class:"me-2"},Te={class:"tab-content"},Be={key:0,class:"tab-pane fade show active"},Me={class:"card mb-3"},_e={class:"card-body"},Pe={class:"form-check mb-2"},Ee={class:"form-check mb-2"},Ie={class:"form-check mb-2"},Le={class:"row align-items-center mb-2"},Ue={class:"col-sm-8"},Ae={class:"card mb-3"},Re={class:"card-body"},Ve={class:"bg-dark text-light p-3 rounded small",style:{"max-height":"200px","overflow-y":"auto"}},Ne=["disabled"],Oe={key:0},qe={key:1},ze={key:1,class:"tab-pane fade show active"},Ge={class:"card mb-3"},Je={class:"card-body"},We={class:"row align-items-center mb-2"},Ke={class:"col-sm-8"},He={class:"row align-items-center mb-2"},Ye={class:"col-sm-8"},Qe={class:"row align-items-center mb-2"},Xe={class:"col-sm-8"},Ze={class:"form-check mb-2"},et={class:"form-check mb-2"},tt={class:"form-check mb-2"},ot={key:0,class:"row align-items-center mb-2 ms-4"},st={class:"col-sm-7"},lt={class:"card mb-3"},at={class:"card-body"},nt={class:"mb-1"},it=["disabled"],rt={key:0},dt={key:1},ut={key:2,class:"tab-pane fade show active"},ct={class:"card mb-3"},mt={class:"card-body"},bt={class:"form-check mb-2"},pt={class:"form-check mb-2"},vt={class:"form-check mb-2"},ft={class:"card mb-3"},gt={class:"card-body"},yt={class:"mb-1"},kt={class:"mb-1"},xt={class:"mb-1"},wt={class:"mb-0"},ht=["disabled"],Ct={key:0},$t={key:1},St=te({__name:"ExportDialog",props:{project:{}},emits:["close"],setup(j,{emit:p}){const l=j,d=p,u=C("lrc"),x=C({includeMetadata:!0,includeSyllables:!0,includeWordTiming:!0,precision:2}),n=C({backgroundColor:"#000080",textColor:"#FFFFFF",highlightColor:"#FFFF00",showBorder:!0,centerText:!0,showMetadata:!0,metadataDuration:3,showCaptions:!0,captionDuration:2}),h=C({prettyPrint:!0,includeMetadata:!0,includeStats:!0}),f=C(!1),y=C(null),r=[{id:"lrc",label:"LRC",icon:"üìÑ"},{id:"cdg",label:"CDG",icon:"üíø"},{id:"json",label:"JSON",icon:"üíæ"}],F=R(()=>ye(l.project)),_=R(()=>{try{const c=ee.toLRC(l.project).split("\n");return c.slice(0,10).join("\n")+(c.length>10?"\n...":"")}catch(c){return"Preview not available"}}),E=R(()=>{const c=F.value.duration,a=Math.ceil(c*75)*24;return Math.ceil(a/1024)}),O=R(()=>{const c=JSON.stringify(l.project);return Math.ceil(c.length/1024)});function V(){d("close")}function q(c){const o=Math.floor(c/60),a=Math.floor(c%60);return"".concat(o,":").concat(a.toString().padStart(2,"0"))}async function z(){f.value=!0;try{const c=ee.toLRC(l.project),o=new Blob([c],{type:"text/plain;charset=utf-8"}),a=URL.createObjectURL(o),$=document.createElement("a");$.href=a,$.download="".concat(l.project.name.toLowerCase().replace(/\s+/g,"_"),".lrc"),document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(a),M("success","‚úÖ LRC file exported successfully!")}catch(c){M("error","‚ùå Export failed: ".concat(c.message))}finally{f.value=!1}}async function N(){f.value=!0;try{M("error","‚ùå CDG export requires Node.js environment. Use the CLI tool: npx tsx src/karaoke/demo/generateCDG.ts")}catch(c){M("error","‚ùå Export failed: ".concat(c.message))}finally{f.value=!1}}async function G(){f.value=!0;try{const c=h.value.prettyPrint?JSON.stringify(l.project,null,2):JSON.stringify(l.project),o=new Blob([c],{type:"application/json"}),a=URL.createObjectURL(o),$=document.createElement("a");$.href=a,$.download="".concat(l.project.name.toLowerCase().replace(/\s+/g,"_"),".json"),document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(a),M("success","‚úÖ JSON file exported successfully!")}catch(c){M("error","‚ùå Export failed: ".concat(c.message))}finally{f.value=!1}}function M(c,o){y.value={type:c,message:o},setTimeout(()=>{y.value=null},4e3)}return(c,o)=>(b(),v("div",{class:"modal show d-block",tabindex:"-1",onClick:L(V,["self"])},[e("div",ke,[e("div",xe,[e("div",{class:"modal-header"},[o[14]||(o[14]=e("h5",{class:"modal-title"},"üì§ Export Project",-1)),e("button",{type:"button",class:"btn-close",onClick:V,"aria-label":"Close"})]),e("div",we,[e("div",he,[e("h5",Ce,m(j.project.name),1),e("p",$e,[e("em",null,"by "+m(j.project.artist),1)]),e("div",Se,[e("span",null,m(F.value.timedSyllables)+" syllables",1),o[15]||(o[15]=e("span",null,"‚Ä¢",-1)),e("span",null,m(q(F.value.duration)),1),o[16]||(o[16]=e("span",null,"‚Ä¢",-1)),e("span",null,m(F.value.completionPercentage)+"% complete",1)])]),e("ul",Fe,[(b(),v(K,null,oe(r,a=>e("li",{class:"nav-item",key:a.id},[e("button",{class:U(["nav-link",{active:u.value===a.id}]),onClick:$=>u.value=a.id,type:"button"},[e("span",De,m(a.icon),1),g(" "+m(a.label),1)],10,je)])),64))]),e("div",Te,[u.value==="lrc"?(b(),v("div",Be,[o[24]||(o[24]=e("h5",null,"LRC V2.1 Export",-1)),o[25]||(o[25]=e("p",{class:"text-muted"}," Export as Enhanced LRC format with syllable-level timing. Compatible with modern karaoke players. ",-1)),e("div",Me,[o[22]||(o[22]=e("div",{class:"card-header"},[e("strong",null,"Settings")],-1)),e("div",_e,[e("div",Pe,[w(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[0]||(o[0]=a=>x.value.includeMetadata=a),id:"lrcMetadata"},null,512),[[B,x.value.includeMetadata]]),o[17]||(o[17]=e("label",{class:"form-check-label",for:"lrcMetadata"}," Include metadata (title, artist, album) ",-1))]),e("div",Ee,[w(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=a=>x.value.includeSyllables=a),id:"lrcSyllables"},null,512),[[B,x.value.includeSyllables]]),o[18]||(o[18]=e("label",{class:"form-check-label",for:"lrcSyllables"}," Include syllable timing (V2.1 format) ",-1))]),e("div",Ie,[w(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=a=>x.value.includeWordTiming=a),id:"lrcWordTiming"},null,512),[[B,x.value.includeWordTiming]]),o[19]||(o[19]=e("label",{class:"form-check-label",for:"lrcWordTiming"}," Include word timing markers ",-1))]),e("div",Le,[o[21]||(o[21]=e("label",{class:"col-sm-4 col-form-label"},"Timestamp precision:",-1)),e("div",Ue,[w(e("select",{class:"form-select","onUpdate:modelValue":o[3]||(o[3]=a=>x.value.precision=a)},[...o[20]||(o[20]=[e("option",{value:"2"},"Centisecond (00.00)",-1),e("option",{value:"3"},"Millisecond (00.000)",-1)])],512),[[se,x.value.precision]])])])])]),e("div",Ae,[o[23]||(o[23]=e("div",{class:"card-header"},[e("strong",null,"Preview")],-1)),e("div",Re,[e("pre",Ve,m(_.value),1)])]),e("button",{class:"btn btn-primary w-100",onClick:z,disabled:f.value},[f.value?(b(),v("span",qe,"‚è≥ Exporting...")):(b(),v("span",Oe,"üìÑ Export LRC File"))],8,Ne)])):S("",!0),u.value==="cdg"?(b(),v("div",ze,[o[39]||(o[39]=e("h5",null,"CDG Export",-1)),o[40]||(o[40]=e("p",{class:"text-muted"}," Export as CD+G format for professional karaoke machines. Creates binary .cdg file with graphics data. ",-1)),e("div",Ge,[o[33]||(o[33]=e("div",{class:"card-header"},[e("strong",null,"Settings")],-1)),e("div",Je,[e("div",We,[o[26]||(o[26]=e("label",{class:"col-sm-4 col-form-label"},"Background color:",-1)),e("div",Ke,[w(e("input",{type:"color",class:"form-control form-control-color","onUpdate:modelValue":o[4]||(o[4]=a=>n.value.backgroundColor=a)},null,512),[[P,n.value.backgroundColor]])])]),e("div",He,[o[27]||(o[27]=e("label",{class:"col-sm-4 col-form-label"},"Text color:",-1)),e("div",Ye,[w(e("input",{type:"color",class:"form-control form-control-color","onUpdate:modelValue":o[5]||(o[5]=a=>n.value.textColor=a)},null,512),[[P,n.value.textColor]])])]),e("div",Qe,[o[28]||(o[28]=e("label",{class:"col-sm-4 col-form-label"},"Highlight color:",-1)),e("div",Xe,[w(e("input",{type:"color",class:"form-control form-control-color","onUpdate:modelValue":o[6]||(o[6]=a=>n.value.highlightColor=a)},null,512),[[P,n.value.highlightColor]])])]),e("div",Ze,[w(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[7]||(o[7]=a=>n.value.showBorder=a),id:"cdgBorder"},null,512),[[B,n.value.showBorder]]),o[29]||(o[29]=e("label",{class:"form-check-label",for:"cdgBorder"}," Show decorative border ",-1))]),e("div",et,[w(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[8]||(o[8]=a=>n.value.centerText=a),id:"cdgCenter"},null,512),[[B,n.value.centerText]]),o[30]||(o[30]=e("label",{class:"form-check-label",for:"cdgCenter"}," Center text on screen ",-1))]),e("div",tt,[w(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[9]||(o[9]=a=>n.value.showCaptions=a),id:"cdgCaptions"},null,512),[[B,n.value.showCaptions]]),o[31]||(o[31]=e("label",{class:"form-check-label",for:"cdgCaptions"},' Show captions (e.g., "Verse 1", "Chorus") ',-1))]),n.value.showCaptions?(b(),v("div",ot,[o[32]||(o[32]=e("label",{class:"col-sm-5 col-form-label small"},"Caption duration (seconds):",-1)),e("div",st,[w(e("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":o[10]||(o[10]=a=>n.value.captionDuration=a),min:"1",max:"10",step:"0.5"},null,512),[[P,n.value.captionDuration,void 0,{number:!0}]])])])):S("",!0)])]),e("div",lt,[o[38]||(o[38]=e("div",{class:"card-header"},[e("strong",null,"File Information")],-1)),e("div",at,[o[35]||(o[35]=e("p",{class:"mb-1"},[e("strong",null,"Format:"),g(" CD+G Binary")],-1)),e("p",nt,[o[34]||(o[34]=e("strong",null,"Estimated size:",-1)),g(" "+m(E.value)+" KB",1)]),o[36]||(o[36]=e("p",{class:"mb-1"},[e("strong",null,"Resolution:"),g(" 288√ó192 pixels (6-bit color)")],-1)),o[37]||(o[37]=e("p",{class:"mb-0"},[e("strong",null,"Packet rate:"),g(" 75 packets/second")],-1))])]),e("button",{class:"btn btn-primary w-100",onClick:N,disabled:f.value},[f.value?(b(),v("span",dt,"‚è≥ Exporting...")):(b(),v("span",rt,"üíø Export CDG File"))],8,it)])):S("",!0),u.value==="json"?(b(),v("div",ut,[o[50]||(o[50]=e("h5",null,"JSON Export",-1)),o[51]||(o[51]=e("p",{class:"text-muted"}," Export complete project data as JSON for backup, sharing, or programmatic use. ",-1)),e("div",ct,[o[44]||(o[44]=e("div",{class:"card-header"},[e("strong",null,"Settings")],-1)),e("div",mt,[e("div",bt,[w(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[11]||(o[11]=a=>h.value.prettyPrint=a),id:"jsonPretty"},null,512),[[B,h.value.prettyPrint]]),o[41]||(o[41]=e("label",{class:"form-check-label",for:"jsonPretty"}," Pretty print (formatted, readable) ",-1))]),e("div",pt,[w(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[12]||(o[12]=a=>h.value.includeMetadata=a),id:"jsonMetadata"},null,512),[[B,h.value.includeMetadata]]),o[42]||(o[42]=e("label",{class:"form-check-label",for:"jsonMetadata"}," Include project metadata ",-1))]),e("div",vt,[w(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[13]||(o[13]=a=>h.value.includeStats=a),id:"jsonStats"},null,512),[[B,h.value.includeStats]]),o[43]||(o[43]=e("label",{class:"form-check-label",for:"jsonStats"}," Include statistics ",-1))])])]),e("div",ft,[o[49]||(o[49]=e("div",{class:"card-header"},[e("strong",null,"üìä Export Info")],-1)),e("div",gt,[e("p",yt,[o[45]||(o[45]=e("strong",null,"Lines:",-1)),g(" "+m(F.value.totalLines),1)]),e("p",kt,[o[46]||(o[46]=e("strong",null,"Words:",-1)),g(" "+m(F.value.totalWords),1)]),e("p",xt,[o[47]||(o[47]=e("strong",null,"Syllables:",-1)),g(" "+m(F.value.totalSyllables),1)]),e("p",wt,[o[48]||(o[48]=e("strong",null,"Estimated size:",-1)),g(" ~"+m(O.value)+" KB",1)])])]),e("button",{class:"btn btn-primary w-100",onClick:G,disabled:f.value},[f.value?(b(),v("span",$t,"‚è≥ Exporting...")):(b(),v("span",Ct,"üíæ Export JSON File"))],8,ht)])):S("",!0)]),y.value?(b(),v("div",{key:0,class:U(["alert mt-3",y.value.type==="success"?"alert-success":"alert-danger"])},m(y.value.message),3)):S("",!0)])])])]))}});const Ft=le(St,[["__scopeId","data-v-3a56e8f4"]]),jt={class:"compose-view"},Dt={class:"modal-content"},Tt={class:"modal-body"},Bt={class:"mb-3"},Mt={class:"mb-3"},_t={class:"mb-3"},Pt={class:"mb-3"},Et={class:"mb-3"},It={class:"modal-footer"},Lt=["disabled"],Ut={class:"modal-content"},At={class:"modal-body"},Rt={class:"row"},Vt={class:"col-md-6"},Nt={key:0,class:"card"},Ot={class:"card-body"},qt={class:"d-flex justify-content-between"},zt={class:"d-flex justify-content-between"},Gt={class:"d-flex justify-content-between"},Jt={class:"d-flex justify-content-between"},Wt={key:0,class:"alert alert-warning mt-2 mb-0 p-2"},Kt={class:"projects-screen py-4"},Ht={class:"card"},Yt={class:"card-header compose-header"},Qt={class:"row align-items-center"},Xt={class:"col-md-6 text-end"},Zt={class:"card-body"},eo={key:0},to={class:"list-group"},oo={class:"btn-group w-100",role:"group"},so=["onClick"],lo={class:"fw-bold d-flex align-items-center"},ao={class:"text-muted small"},no={class:"text-muted small"},io={key:0,class:"text-muted small"},ro=["onClick"],uo=["onClick"],co={key:1,class:"text-center py-5"},mo={class:"developer-toolbar"},bo={class:"container"},po={class:"toolbar-toggle"},vo={key:0,class:"toolbar-content"},fo={class:"toolbar-buttons"},go=te({__name:"ComposeView",setup(j){const p=fe(),l=C(!1),d=C(!1),u=C(!1),x=C(null),n=C([]),h=C(!0),f=C(!0),y=C(null),r=C({name:"",artist:"",genre:"",lyricsText:"",audioFile:null}),F=R(()=>r.value.name&&r.value.artist&&r.value.audioFile);ue(()=>r.value.lyricsText,s=>{if(!s)return;const{metadata:t}=Z(s);t.title&&!r.value.name.trim()&&(r.value.name=t.title),t.author&&!r.value.artist.trim()&&(r.value.artist=t.author)});const _=()=>{l.value=!1,G()},E=()=>{d.value=!1},O=()=>{y.value=I.getStorageInfo(),d.value=!0},V=async()=>{if(confirm("This will remove all cached audio files from storage. Projects will still work but may need to re-select audio files. Continue?")){const s=await I.clearOldAudioFiles();alert("Cleared ".concat(s," audio files from cache.")),y.value=I.getStorageInfo()}},q=async()=>{const s=await I.testIndexedDBConnection();let t="üîç IndexedDB Test Results:\n\n";s.available?t+="‚úÖ IndexedDB is supported by your browser\n":t+="‚ùå IndexedDB is NOT supported by your browser\n",s.canStore?(t+="‚úÖ Can store files in IndexedDB\n",t+="üéµ Your 4-5MB audio files will work perfectly!"):(t+="‚ùå Cannot store files in IndexedDB\n",s.error&&(t+="Error: ".concat(s.error,"\n")),t+="‚ö†Ô∏è Will fallback to other storage methods"),alert(t)},z=s=>{switch(s){case"base64":return"bg-success";case"indexeddb":return"bg-info";case"reference":return"bg-warning";default:return"bg-secondary"}},N=s=>{switch(s){case"base64":return"üì¶ Base64";case"indexeddb":return"üóÑÔ∏è IndexedDB";case"reference":return"üìÅ Reference";default:return"Unknown"}},G=()=>{r.value={name:"",artist:"",genre:"",lyricsText:"",audioFile:null}},M=s=>{const t=s.target;t.files&&t.files[0]&&(r.value.audioFile=t.files[0])},c=async()=>{var D;if(console.log("createProject called",{canCreate:F.value,name:r.value.name,artist:r.value.artist,audioFile:(D=r.value.audioFile)==null?void 0:D.name}),!F.value){console.log("Cannot create project - missing requirements");return}const{lyrics:s}=Z(r.value.lyricsText),t="project-".concat(Date.now());console.log("Storing audio file...");const k=await I.storeAudioFile(r.value.audioFile,t),i={id:t,name:r.value.name,artist:r.value.artist,genre:r.value.genre||"Unknown",createdAt:new Date,updatedAt:new Date,audioFile:{name:r.value.audioFile.name,file:r.value.audioFile,url:URL.createObjectURL(r.value.audioFile),storedData:k},lyrics:s,timings:[],isCompleted:!1};n.value.push(i);try{J(),_(),console.log("Project created successfully:",i.name),h.value&&p.push("/timing/".concat(t))}catch(T){console.error("Error creating project:",T),alert("Error creating project: "+T)}},o=async s=>{h.value&&p.push("/timing/".concat(s.id))},a=async s=>{if(confirm('Are you sure you want to delete "'.concat(s.name,'"? This action cannot be undone.'))){const t=n.value.findIndex(k=>k.id===s.id);t>-1&&(n.value.splice(t,1),J(),console.log('Project "'.concat(s.name,'" deleted successfully')))}},$=s=>{x.value=s,u.value=!0},ae=()=>{u.value=!1,x.value=null},ne=s=>new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(s),ie=()=>{const s=localStorage.getItem("karaokeProjects");if(s)try{const t=JSON.parse(s);n.value=t.map(k=>({...k,createdAt:new Date(k.createdAt),updatedAt:new Date(k.updatedAt),audioFile:{...k.audioFile,file:null}})),console.log("Loaded ".concat(n.value.length," projects from storage")),n.value.forEach((k,i)=>{var D,T,A,Q,X;console.log("üîç Project ".concat(i+1,': "').concat(k.name,'"')),console.log("   audioFile:",k.audioFile),console.log("   storedData:",(D=k.audioFile)==null?void 0:D.storedData),console.log("   storageType:",(A=(T=k.audioFile)==null?void 0:T.storedData)==null?void 0:A.storageType),console.log("   Badge will show:",N(((X=(Q=k.audioFile)==null?void 0:Q.storedData)==null?void 0:X.storageType)||"unknown")),console.log("---")})}catch(t){console.error("Error loading projects:",t)}},J=()=>{try{const s=n.value.map(t=>({...t,audioFile:{...t.audioFile,file:null,url:void 0}}));localStorage.setItem("karaokeProjects",JSON.stringify(s)),console.log("üíæ Saved ".concat(n.value.length," projects to storage")),s.forEach((t,k)=>{var i;console.log("Project ".concat(k,": ").concat(t.name," - StoredData preserved:"),{hasStoredData:!!t.audioFile.storedData,storageType:(i=t.audioFile.storedData)==null?void 0:i.storageType,duration:t.audioFile.duration})})}catch(s){console.error("Error saving projects:",s)}},H=()=>{let s=0;n.value.forEach(t=>{var k;if(t.audioFile&&!t.audioFile.storedData){let i="reference";const D=((k=t.audioFile.file)==null?void 0:k.lastModified)||0,T="audio_".concat(t.id,"_").concat(t.audioFile.name,"_").concat(D);localStorage.getItem("audio_".concat(T))&&(i="base64"),t.audioFile.storedData={name:t.audioFile.name,size:0,type:"audio/mpeg",lastModified:Date.now(),storageType:i},s++,console.log("üîß Fixed storage badge for project: ".concat(t.name," -> ").concat(i))}}),s>0?(J(),alert("Fixed storage badges for ".concat(s," project(s). Refresh the page to see the changes."))):alert("All projects already have proper storage data.")},re=()=>{confirm("Are you sure you want to delete ALL saved projects? This cannot be undone.")&&(localStorage.removeItem("karaokeProjects"),n.value=[],console.log("All projects cleared from localStorage"),alert("All projects have been cleared. You can now start fresh!"))},de=()=>{f.value=!f.value},Y=s=>{s.code==="Escape"&&(l.value?(s.preventDefault(),_()):d.value&&(s.preventDefault(),E()))};return ce(async()=>{ie(),await new Promise(t=>setTimeout(t,100));const s=I.getStorageInfo();console.log("üîç Audio storage service initialized:",s),window.indexedDB?console.log("‚úÖ IndexedDB is available in this browser"):console.warn("‚ùå IndexedDB is NOT available in this browser"),s.quotaUsedMB>s.quotaLimitMB*.9&&console.warn("‚ö†Ô∏è Storage quota nearly full:",s.quotaUsedMB,"/",s.quotaLimitMB,"MB"),s.method==="indexeddb"?console.log("üóÑÔ∏è Using IndexedDB - perfect for 4-5MB files!"):console.log("üì¶ Using fallback storage method:",s.method),window.addEventListener("keydown",Y)}),me(()=>{h.value=!1,window.removeEventListener("keydown",Y)}),(s,t)=>{const k=ge("router-link");return b(),v(K,null,[e("div",jt,[l.value?(b(),v("div",{key:0,class:U(["modal",{show:l.value}]),onClick:_},[e("div",{class:"modal-dialog",onClick:t[4]||(t[4]=L(()=>{},["stop"]))},[e("div",Dt,[e("div",{class:"modal-header"},[t[9]||(t[9]=e("h5",{class:"modal-title"},"Create New Karaoke Project",-1)),e("button",{type:"button",class:"btn-close",onClick:_})]),e("div",Tt,[e("form",{onSubmit:L(c,["prevent"])},[e("div",Bt,[t[10]||(t[10]=e("label",{for:"projectName",class:"form-label"},"Song Title *",-1)),w(e("input",{type:"text",class:"form-control",id:"projectName","onUpdate:modelValue":t[0]||(t[0]=i=>r.value.name=i),required:"",placeholder:"Enter song title"},null,512),[[P,r.value.name]])]),e("div",Mt,[t[11]||(t[11]=e("label",{for:"projectArtist",class:"form-label"},"Artist *",-1)),w(e("input",{type:"text",class:"form-control",id:"projectArtist","onUpdate:modelValue":t[1]||(t[1]=i=>r.value.artist=i),required:"",placeholder:"Enter artist name"},null,512),[[P,r.value.artist]])]),e("div",_t,[t[13]||(t[13]=e("label",{for:"projectGenre",class:"form-label"},"Genre",-1)),w(e("select",{class:"form-control",id:"projectGenre","onUpdate:modelValue":t[2]||(t[2]=i=>r.value.genre=i)},[...t[12]||(t[12]=[W('<option value="" data-v-6032be75>Select Genre</option><option value="Pop" data-v-6032be75>Pop</option><option value="Rock" data-v-6032be75>Rock</option><option value="Country" data-v-6032be75>Country</option><option value="Hip-Hop" data-v-6032be75>Hip-Hop</option><option value="R&amp;B" data-v-6032be75>R&amp;B</option><option value="Jazz" data-v-6032be75>Jazz</option><option value="Classical" data-v-6032be75>Classical</option><option value="Other" data-v-6032be75>Other</option>',9)])],512),[[se,r.value.genre]])]),e("div",Pt,[t[14]||(t[14]=e("label",{for:"audioFile",class:"form-label"},"Audio File (MP3, WAV) *",-1)),e("input",{type:"file",class:"form-control",id:"audioFile",accept:"audio/*",onChange:M,required:""},null,32)]),e("div",Et,[t[15]||(t[15]=e("label",{for:"lyrics",class:"form-label"},"Lyrics",-1)),w(e("textarea",{class:"form-control",id:"lyrics",rows:"8","onUpdate:modelValue":t[3]||(t[3]=i=>r.value.lyricsText=i),placeholder:"Paste your lyrics here (one line per verse/chorus line)..."},null,512),[[P,r.value.lyricsText]]),t[16]||(t[16]=e("div",{class:"form-text"},"Each line will become a timing point for synchronization",-1))])],32)]),e("div",It,[e("button",{type:"button",class:"btn btn-secondary",onClick:_},"Cancel"),e("button",{type:"button",class:"btn btn-primary",onClick:c,disabled:!F.value}," Create Project ",8,Lt)])])])],2)):S("",!0),d.value?(b(),v("div",{key:1,class:U(["modal",{show:d.value}]),onClick:E},[e("div",{class:"modal-dialog",onClick:t[5]||(t[5]=L(()=>{},["stop"]))},[e("div",Ut,[e("div",{class:"modal-header"},[t[17]||(t[17]=e("h5",{class:"modal-title"},"üóÇÔ∏è Audio Storage Information",-1)),e("button",{type:"button",class:"btn-close",onClick:E})]),e("div",At,[e("div",Rt,[t[27]||(t[27]=W('<div class="col-md-6" data-v-6032be75><h6 data-v-6032be75>Storage Methods</h6><div class="list-group list-group-flush" data-v-6032be75><div class="list-group-item d-flex justify-content-between align-items-center" data-v-6032be75><span data-v-6032be75>üì¶ Base64 (localStorage)</span><span class="badge bg-warning rounded-pill" data-v-6032be75>‚â§1MB</span></div><div class="list-group-item d-flex justify-content-between align-items-center" data-v-6032be75><span data-v-6032be75>üóÑÔ∏è IndexedDB</span><span class="badge bg-success rounded-pill" data-v-6032be75>4-5MB+ Files</span></div><div class="list-group-item d-flex justify-content-between align-items-center" data-v-6032be75><span data-v-6032be75>üìÅ Reference</span><span class="badge bg-warning rounded-pill" data-v-6032be75>Re-select</span></div></div></div>',1)),e("div",Vt,[t[26]||(t[26]=e("h6",null,"Current Usage",-1)),y.value?(b(),v("div",Nt,[e("div",Ot,[e("div",qt,[t[18]||(t[18]=e("span",null,"Preferred:",-1)),e("strong",null,m(y.value.method),1)]),e("div",zt,[t[19]||(t[19]=e("span",null,"Audio Files:",-1)),e("strong",null,m(y.value.count),1)]),e("div",Gt,[t[20]||(t[20]=e("span",null,"Audio Size:",-1)),e("strong",null,m(y.value.sizeMB)+" MB",1)]),e("div",Jt,[t[21]||(t[21]=e("span",null,"Storage Used:",-1)),e("strong",null,m(y.value.quotaUsedMB)+"/"+m(y.value.quotaLimitMB)+" MB",1)]),y.value.quotaUsedMB>y.value.quotaLimitMB*.8?(b(),v("div",Wt,[...t[22]||(t[22]=[e("small",null,[e("i",{class:"bi bi-exclamation-triangle"}),g(" Storage nearly full!")],-1)])])):S("",!0)])])):S("",!0),e("div",{class:"mt-2"},[e("button",{class:"btn btn-outline-info btn-sm w-100 mb-2",onClick:q},[...t[23]||(t[23]=[e("i",{class:"bi bi-gear"},null,-1),g(" Test IndexedDB ",-1)])]),e("button",{class:"btn btn-outline-success btn-sm w-100 mb-2",onClick:H},[...t[24]||(t[24]=[e("i",{class:"bi bi-wrench"},null,-1),g(" Fix Storage Badges ",-1)])]),e("button",{class:"btn btn-outline-warning btn-sm w-100",onClick:V},[...t[25]||(t[25]=[e("i",{class:"bi bi-trash3"},null,-1),g(" Clear Audio Cache ",-1)])])])])]),t[28]||(t[28]=W('<hr data-v-6032be75><div class="alert alert-info" data-v-6032be75><h6 data-v-6032be75><i class="bi bi-info-circle" data-v-6032be75></i> Storage Methods Explained:</h6><ul class="mb-0" data-v-6032be75><li data-v-6032be75><strong data-v-6032be75>IndexedDB:</strong> Best for 4-5MB+ files - up to ~1GB capacity, persistent storage</li><li data-v-6032be75><strong data-v-6032be75>Base64:</strong> Small files only (‚â§1MB) - fastest loading but limited by browser quota</li><li data-v-6032be75><strong data-v-6032be75>Reference:</strong> Fallback method - you&#39;ll need to re-select files when loading</li></ul><div class="mt-2 p-2 bg-light rounded" data-v-6032be75><small data-v-6032be75><strong data-v-6032be75>üí° IndexedDB is a built-in browser feature:</strong></small><br data-v-6032be75><small data-v-6032be75>‚Ä¢ No setup required - works automatically</small><br data-v-6032be75><small data-v-6032be75>‚Ä¢ Available in all modern browsers (Chrome, Firefox, Safari, Edge)</small><br data-v-6032be75><small data-v-6032be75>‚Ä¢ Perfect for your 4-5MB audio files - no quota issues!</small><br data-v-6032be75><small data-v-6032be75>‚Ä¢ Use &quot;Test IndexedDB&quot; button to verify it&#39;s working</small></div></div>',2))]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary",onClick:E},"Close")])])])],2)):S("",!0),e("div",Kt,[e("div",Ht,[e("div",Yt,[e("div",Qt,[t[32]||(t[32]=e("div",{class:"col-md-6"},[e("h2",{class:"mb-1"},"üéº Karaoke Composer"),e("p",{class:"mb-0 text-muted"},"Create and sync your karaoke tracks")],-1)),e("div",Xt,[e("button",{class:"btn btn-primary me-2",onClick:t[6]||(t[6]=i=>l.value=!0)},[...t[29]||(t[29]=[e("i",{class:"bi bi-plus-circle"},null,-1),g(" New Project ",-1)])]),e("button",{class:"btn btn-info btn-sm me-2",onClick:O,title:"Audio storage information"},[...t[30]||(t[30]=[e("i",{class:"bi bi-info-circle"},null,-1),g(" Storage ",-1)])]),e("button",{class:"btn btn-danger btn-sm",onClick:re,title:"Clear all saved projects"},[...t[31]||(t[31]=[e("i",{class:"bi bi-trash3"},null,-1),g(" Clear All ",-1)])])])])]),e("div",Zt,[n.value.length>0?(b(),v("div",eo,[t[38]||(t[38]=e("h5",{class:"mb-3"},"Your Projects",-1)),e("div",to,[(b(!0),v(K,null,oe(n.value,i=>{var D,T;return b(),v("div",{key:i.id,class:"list-group-item p-0 project-item"},[e("div",oo,[e("button",{class:"btn btn-outline-secondary text-start flex-grow-1 project-content-btn",onClick:A=>o(i)},[e("div",lo,[t[33]||(t[33]=e("i",{class:"bi bi-music-note-beamed me-2 text-primary"},null,-1)),g(" "+m(i.name),1)]),e("div",ao,"by "+m(i.artist)+" ‚Ä¢ "+m(i.genre),1),e("div",no,[t[34]||(t[34]=e("i",{class:"bi bi-clock me-1"},null,-1)),g(" Last updated "+m(ne(i.updatedAt)),1)]),i.audioFile?(b(),v("div",io,[t[35]||(t[35]=e("i",{class:"bi bi-file-music me-1"},null,-1)),g(" "+m(i.audioFile.name)+" ",1),e("span",{class:U(["badge ms-2",z(((D=i.audioFile.storedData)==null?void 0:D.storageType)||"unknown")])},m(N(((T=i.audioFile.storedData)==null?void 0:T.storageType)||"unknown")),3)])):S("",!0)],8,so),e("button",{class:"btn btn-success export-btn",onClick:L(A=>$(i),["stop"]),title:"Export project for terminal demo"},[...t[36]||(t[36]=[e("i",{class:"bi bi-download"},null,-1)])],8,ro),e("button",{class:"btn btn-warning delete-btn",onClick:L(A=>a(i),["stop"]),title:"Delete project"},[...t[37]||(t[37]=[e("i",{class:"bi bi-trash3"},null,-1)])],8,uo)])])}),128))])])):(b(),v("div",co,[t[40]||(t[40]=e("i",{class:"bi bi-music-note-list display-1 text-muted mb-3"},null,-1)),t[41]||(t[41]=e("h5",{class:"text-muted"},"No projects yet",-1)),t[42]||(t[42]=e("p",{class:"text-muted"},"Create your first karaoke project to get started",-1)),e("button",{class:"btn btn-primary btn-lg",onClick:t[7]||(t[7]=i=>l.value=!0)},[...t[39]||(t[39]=[e("i",{class:"bi bi-plus-circle me-2"},null,-1),g("Create Your First Project ",-1)])])]))])])])]),e("div",mo,[e("div",bo,[e("div",{class:"toolbar-header",onClick:de},[t[43]||(t[43]=e("div",{class:"toolbar-label"},[e("i",{class:"bi bi-code-slash me-1"}),e("small",{class:"text-muted"},"Developer Tools")],-1)),e("div",po,[e("i",{class:U(["bi bi-chevron-down",{"rotate-180":!f.value}])},null,2)])]),f.value?(b(),v("div",vo,[e("div",fo,[be(k,{to:"/test-timing",class:"btn btn-outline-primary btn-sm me-2"},{default:pe(()=>[...t[44]||(t[44]=[e("i",{class:"bi bi-play-circle me-1"},null,-1),g(" Test Word Timing Editor ",-1)])]),_:1}),e("button",{class:"btn btn-outline-secondary btn-sm me-2",onClick:t[8]||(t[8]=i=>d.value=!0)},[...t[45]||(t[45]=[e("i",{class:"bi bi-database me-1"},null,-1),g(" Storage Info ",-1)])]),e("button",{class:"btn btn-outline-info btn-sm",onClick:H},[...t[46]||(t[46]=[e("i",{class:"bi bi-wrench me-1"},null,-1),g(" Fix Badges ",-1)])])])])):S("",!0)])]),u.value&&x.value?(b(),ve(Ft,{key:0,project:x.value,onClose:ae},null,8,["project"])):S("",!0)],64)}}});const wo=le(go,[["__scopeId","data-v-6032be75"]]);export{wo as default};
//# sourceMappingURL=ComposeView-1fa2b1b8.js.map
