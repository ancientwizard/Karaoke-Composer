System.register(["./lyricsParser-legacy-fd32a37b.js","./index-legacy-1803f8de.js"],function(e,t){"use strict";var a,r,o,i,s,l,d,n,u,m,c,f,v,h,b,p,w,g,x;return{setters:[e=>{a=e.a},e=>{r=e.d,o=e.r,i=e.c,s=e.l,l=e.z,d=e.m,n=e.k,u=e.a,m=e.b,c=e.F,f=e.e,v=e.n,h=e.t,b=e.g,p=e.o,w=e.B,g=e.j,x=e._}],execute:function(){var t=document.createElement("style");t.textContent=".word-timing-editor[data-v-a7e70df8]{width:100%;margin:5px 0;padding:0 4px}.timeline-track[data-v-a7e70df8]{position:relative;height:40px;overflow:hidden}.timeline-track.with-background[data-v-a7e70df8]{background:linear-gradient(to bottom,#fafafa 0%,#f0f0f0 100%);box-shadow:inset 0 1px 3px rgba(0,0,0,.1)}.timeline-track.with-border[data-v-a7e70df8]{border:1px solid #c4c4c4;border-radius:6px}.timeline-baseline[data-v-a7e70df8]{position:absolute;top:50%;left:0;right:0;height:1px;background:#bbbbbb;z-index:1}.word-car[data-v-a7e70df8]{position:absolute;top:50%;height:28px;transform:translateY(-50%);background:#e3f2fd;border:1px solid #1976d2;border-radius:3px;cursor:grab;z-index:10;display:flex;align-items:center;justify-content:center;transition:all .1s ease}.word-car[data-v-a7e70df8]:hover{background:#bbdefb;border-color:#1565c0;z-index:15}.word-car:hover .word-text[data-v-a7e70df8]{color:#0a3a7a;text-shadow:0 1px 2px rgba(255,255,255,1)}.word-car.untimed[data-v-a7e70df8]{background:#fff8e1;border:2px dashed #ff8f00;border-color:#ff8f00;opacity:.8}.word-car.untimed[data-v-a7e70df8]:hover{background:#fff3e0;opacity:1;border-style:solid}.word-car.selected[data-v-a7e70df8]{background:#fff3e0;border-color:#f57c00;box-shadow:0 0 0 2px rgba(245,124,0,.4);z-index:20}.word-car.selected .word-text[data-v-a7e70df8]{color:#bf360c;font-weight:600;text-shadow:none}.word-car.dragging[data-v-a7e70df8]{cursor:grabbing;z-index:25;box-shadow:0 2px 8px rgba(0,0,0,.2);background:#fff8e1;border-color:#ff8f00}.word-car.dragging .word-text[data-v-a7e70df8]{color:#ef6c00;text-shadow:0 1px 3px rgba(255,255,255,1)}.word-text[data-v-a7e70df8]{color:#0d47a1;font-size:11px;font-weight:700;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;pointer-events:none;padding:0 6px;text-shadow:0 1px 2px rgba(255,255,255,.9)}.hotspot[data-v-a7e70df8]{position:absolute;background:rgba(255,255,255,.7);border-radius:2px;z-index:30}.hotspot-move[data-v-a7e70df8]{top:2px;left:2px;right:2px;bottom:2px;cursor:grab}.hotspot-move[data-v-a7e70df8]:hover{background:rgba(255,255,255,.9)}.hotspot-resize-end[data-v-a7e70df8]{top:-2px;right:-4px;width:8px;height:calc(100% + 4px);cursor:col-resize;background:rgba(76,175,80,.8);border-radius:0 3px 3px 0;border:1px solid rgba(76,175,80,1)}.hotspot-resize-end[data-v-a7e70df8]:hover{background:rgba(76,175,80,1);width:10px;right:-5px;box-shadow:0 0 4px rgba(76,175,80,.6)}.hotspot-syllable-divider[data-v-a7e70df8]{top:-2px;width:6px;height:calc(100% + 4px);cursor:col-resize;background:rgba(255,152,0,.8);transform:translate(-3px);border-radius:2px;border:1px solid rgba(255,152,0,1)}.hotspot-syllable-divider[data-v-a7e70df8]:hover{background:rgba(255,152,0,1);width:8px;transform:translate(-4px);box-shadow:0 0 4px rgba(255,152,0,.6)}.debug-panel[data-v-a7e70df8]{margin-top:10px;padding:12px;background:#f8f9fa;border:1px solid #dee2e6;border-radius:4px;font-size:12px;font-family:Courier New,monospace}.debug-panel h4[data-v-a7e70df8]{margin:0 0 8px;font-size:14px;font-family:inherit}.debug-panel p[data-v-a7e70df8]{margin:2px 0;line-height:1.4}.selected-word-debug[data-v-a7e70df8]{margin-top:8px;padding:8px;background:#e9ecef;border-radius:3px;max-height:200px;overflow-y:auto}.selected-word-debug pre[data-v-a7e70df8]{margin:4px 0 0;font-size:10px;line-height:1.2}.word-timing-summary[data-v-a7e70df8]{font-family:Courier New,monospace;font-size:11px}.timing-info[data-v-a7e70df8]{background:#d1ecf1;padding:4px 6px;border-radius:3px;margin:4px 0;border-left:3px solid #0c5460}.syllable-durations[data-v-a7e70df8]{margin-top:6px}.syllable-info[data-v-a7e70df8]{padding:2px 4px;margin:1px 0;background:#fff3cd;border-radius:2px;font-size:10px}details[data-v-a7e70df8]{margin-top:8px}summary[data-v-a7e70df8]{cursor:pointer;font-size:10px;color:#6c757d}\n",document.head.appendChild(t);class y{word;constructor(e){this.word={...e},this.validateSyllables()}validateSyllables(){if(0===this.word.syllables.length)throw new Error("Word must have at least one syllable");let e=0;for(const o of this.word.syllables){const t=Math.abs(o.startOffset-e);if(t>a.validation.timingPrecision)throw new Error(`Syllable "${o.text}" has gap or overlap. Expected startOffset: ${e}, got: ${o.startOffset} (error: ${t}ms)`);if(o.duration<=0)throw new Error(`Syllable "${o.text}" must have positive duration, got: ${o.duration}`);e+=o.duration}const t=this.word.endTime-this.word.startTime,r=e;if(Math.abs(t-r)>a.validation.durationTolerance)throw new Error(`Word duration (${t}ms) doesn't match total syllable duration (${r}ms)`)}getWordData(){return{...this.word}}getWordDuration(){return this.word.endTime-this.word.startTime}getAbsoluteSyllables(){return this.word.syllables.map(e=>({text:e.text,startTime:this.word.startTime+e.startOffset,endTime:this.word.startTime+e.startOffset+e.duration}))}moveWord(e){const t=this.getWordDuration();return new y({...this.word,startTime:e,endTime:e+t})}resizeWordEnd(e){if(e<=this.word.startTime)throw new Error("Word end time must be after start time");const t=e-this.word.startTime,a=[...this.word.syllables];if(1===a.length)a[0]={...a[0],duration:t};else{const e=a.length-1,r=t-a[e].startOffset;if(r<=1)throw new Error("Resizing would make last syllable have zero or negative duration");a[e]={...a[e],duration:r}}return new y({...this.word,endTime:e,syllables:a})}resizeWordStart(e){if(e>=this.word.endTime)throw new Error("Word start time must be before end time");const t=this.word.endTime-e,a=[...this.word.syllables];if(1===a.length)a[0]={...a[0],startOffset:0,duration:t};else{const e=a[0].duration,r=t-(this.getWordDuration()-e);if(r<=1)throw new Error("Resizing would make first syllable have zero or negative duration");const o=e-r;a[0]={...a[0],startOffset:0,duration:r};for(let t=1;t<a.length;t++)a[t]={...a[t],startOffset:a[t].startOffset-o}}return new y({...this.word,startTime:e,syllables:a})}moveAndResize(e,t){if(e>=t)throw new Error("Word start time must be before end time");return this.moveWord(e).resizeWordEnd(t)}adjustSyllableBoundary(e,t){if(e<0||e>=this.word.syllables.length-1)throw new Error("Can only adjust boundaries between syllables");const a=t-this.word.startTime;if(a<=this.word.syllables[e].startOffset||a>=this.word.syllables[e+1].startOffset+this.word.syllables[e+1].duration)throw new Error("New syllable boundary is outside valid range");const r=[...this.word.syllables],o=r[e],i=r[e+1],s=a-o.startOffset;r[e]={...o,duration:s};const l=i.startOffset+i.duration;return r[e+1]={...i,startOffset:a,duration:l-a},new y({...this.word,syllables:r})}static fromAbsoluteSyllables(e,t,r,o,i){if(0===i.length)throw new Error("Must have at least one syllable");const s=[];let l=r;for(let f=0;f<i.length;f++){const e=i[f],t=f===i.length-1;let r=Math.round(e.startTime),d=Math.round(e.endTime);Math.abs(r-l)<=a.validation.gapTolerance&&(r=l),d<=r&&(d=r+Math.max(a.validation.timingPrecision,a.syllable.minDuration/1e3)),t&&(d=Math.round(o)),s.push({text:e.text,startTime:r,endTime:d}),l=d}const d=[];let n=0;for(const f of s){const e=f.endTime-f.startTime,t=Math.max(e,a.validation.timingPrecision);d.push({text:f.text,startOffset:n,duration:t}),n+=t}const u=d.reduce((e,t)=>e+t.duration,0),m=Math.round(r)+u,c=Math.round(o)-Math.round(r);return Math.abs(u-c),a.validation.durationTolerance,new y({id:e,text:t,startTime:Math.round(r),endTime:m,syllables:d})}static fromSecondsData(e,t,a,r,o,i=1.2){const s=Math.round(1e3*a),l=Math.round(1e3*r);return y.createWeightedSyllables(e,t,s,l,o,i)}toSecondsData(){const e=this.getAbsoluteSyllables();return{word:{id:this.word.id,text:this.word.text,startTime:this.word.startTime/1e3,endTime:this.word.endTime/1e3},syllables:e.map(e=>({text:e.text,startTime:e.startTime/1e3,endTime:e.endTime/1e3}))}}static createEvenSyllables(e,t,a,r,o){const i=Math.round(r-a),s=Math.floor(i/o.length),l=i%o.length,d=[];let n=0;return o.forEach((e,t)=>{const a=s+(t<l?1:0);d.push({text:e,startOffset:n,duration:a}),n+=a}),new y({id:e,text:t,startTime:Math.round(a),endTime:Math.round(r),syllables:d})}static createWeightedSyllables(e,t,a,r,o,i=1.2){const s=Math.round(r-a),l=o.map((e,t)=>t===o.length-1?i:1),d=l.reduce((e,t)=>e+t,0),n=[];let u=0,m=0;return o.forEach((e,t)=>{let a;t===o.length-1?a=s-m:(a=Math.round(l[t]/d*s),m+=a),n.push({text:e,startOffset:u,duration:a}),u+=a}),new y({id:e,text:t,startTime:Math.round(a),endTime:Math.round(r),syllables:n})}}e("R",y);const T={class:"word-timing-editor"},M=["onMousedown"],k={class:"word-text"},S=["onMousedown"],$=["onMousedown"],z=["title","onMousedown"],E={key:0,class:"debug-panel"},W={key:0},D={key:1,class:"selected-word-debug"},O={class:"word-timing-summary"},F={key:0,class:"timing-info"},B={key:1,class:"syllable-durations"},L=r({__name:"WordTimingEditor",props:{words:{},duration:{},viewStart:{default:0},viewEnd:{default:void 0},showDebug:{type:Boolean,default:!1},showBackground:{type:Boolean,default:!1},showBorder:{type:Boolean,default:!1}},emits:["update:words","select-word"],setup(e,{emit:t}){const r=e,x=t,y=o(),L=o(null),j=o(!1),N=o(null),A=o("move"),C=o(0),P=o(0),R=o(0),_=o(800),I=i(()=>r.viewEnd||r.duration),J=i(()=>I.value-r.viewStart),V=i(()=>_.value/J.value),X=i(()=>r.words.filter(e=>{if(0===e.startTime&&0===e.endTime)return!1;const t=e.startTime,a=e.endTime,o=r.viewStart-.02,i=I.value+.02;return t>=o&&a<=i})),Y=e=>(e-r.viewStart)*V.value,q=e=>{if(0===e.startTime&&0===e.endTime){const t=r.words.filter(e=>0===e.startTime&&0===e.endTime).findIndex(t=>t.id===e.id),a=Math.max(8*e.text.length+20,60);return{left:t*(a+5)+"px",width:`${a}px`}}const t=Y(e.startTime),a=Y(e.endTime)-t,o=Math.max(0,t),i=Math.max(a,24),s=_.value-24,l=Math.min(o,s);return{left:`${l}px`,width:`${Math.min(i,_.value-l)}px`}},G=(e,t)=>{if(!e.syllables||t>=e.syllables.length-1)return{display:"none"};const a=Y(e.startTime),r=Y(e.syllables[t].endTime),o=Y(e.endTime)-a,i=r-a;return{left:`${Math.max(6,Math.min(i,o-6))}px`,display:o>20?"block":"none"}},H=o({}),K=e=>Math.max(a.word.minDuration/1e3,e.endTime-e.startTime),Q=e=>e.endTime-e.startTime,U=e=>{if(e.endTime<=e.startTime){const t=e.startTime+a.word.minDuration/1e3;return{...e,endTime:t}}return e},Z=(e,t,a,r)=>{if(a.preventDefault(),a.stopPropagation(),j.value=!0,N.value=t.id,A.value=e,C.value=a.clientX,"move"===e?P.value=t.startTime:"resize"===e?P.value=t.endTime:"syllable"===e&&"number"==typeof r&&t.syllables&&(P.value=t.syllables[r].endTime,R.value=r,console.log(`ðŸŽ¯ Starting syllable drag: word="${t.text}", syllable=${r}, boundary=${P.value.toFixed(3)}s`)),t.syllables&&t.syllables.length>1){const e=K(t);H.value[t.id]=t.syllables.map(t=>Q(t)/e)}L.value=t.id,x("select-word",t.id),document.addEventListener("mousemove",ee),document.addEventListener("mouseup",te),document.body.style.cursor="move"===e?"grabbing":"col-resize",document.body.style.userSelect="none"},ee=e=>{if(!j.value||!N.value)return;const t=(e.clientX-C.value)/V.value,o=r.words.findIndex(e=>e.id===N.value);if(-1===o)return;const i=[...r.words],s={...i[o]},l=o>0?r.words[o-1]:null,d=o<r.words.length-1?r.words[o+1]:null;if("move"===A.value){const e=K(s);let o=Math.max(0,P.value+t);console.log(`ðŸ”§ Moving "${s.text}": original=${s.startTime}-${s.endTime} (${e}s), newStart=${o}`);const i=o<s.startTime,n=o>s.startTime,u=l&&l.endTime>s.startTime,m=d&&d.startTime<s.endTime;if(console.log(`ðŸ”§ Collision check: movingLeft=${i}, movingRight=${n}, prevOverlapped=${u}, nextOverlapped=${m}`),l&&!u)o=Math.max(o,l.endTime+a.word.collisionMargin/1e3);else if(l&&u&&i){const t=Math.max(0,l.startTime-e-a.word.collisionMargin/1e3);o=Math.max(o,t)}if(d&&!m){const t=d.startTime-e-a.word.collisionMargin/1e3;o=Math.min(o,t)}else if(d&&m&&n){const e=d.endTime+a.word.collisionMargin/1e3;o=Math.min(o,e)}const c=a.editor.viewportBuffer/1e3,f=I.value-e-c;o=Math.min(o,f),o=Math.max(o,r.viewStart-c);const v=((e,t)=>{const a=K(e);return{...e,startTime:t,endTime:t+a}})(s,o);if(console.log(`ðŸ”§ After moveWord: ${v.startTime}-${v.endTime}`),s.startTime=v.startTime,s.endTime=v.endTime,s.syllables&&H.value[s.id]){const t=H.value[s.id];let a=o;s.syllables=s.syllables.map((r,o)=>{const i=t[o]*e,s={...r,startTime:a,endTime:a+i};return a+=i,s})}}else if("resize"===A.value){let e=Math.max(s.startTime+a.word.minDuration/1e3,P.value+t),r=e-s.startTime;if(d){const t=d.startTime-s.startTime-a.word.collisionMargin/1e3;r=Math.min(r,t),e=s.startTime+r}const o=I.value+a.editor.viewportBuffer/1e3;e>o&&(r=o-s.startTime,e=o);const i=((e,t)=>({...e,endTime:e.startTime+t}))(s,r);s.endTime=i.endTime}else if("syllable"===A.value&&s.syllables&&R.value<s.syllables.length-1){const e=a.syllable.minDuration/1e3/2,r=Math.max(s.syllables[R.value].startTime+e,Math.min(s.syllables[R.value+1].endTime-e,P.value+t));console.log(`ðŸ”§ Syllable boundary: "${s.syllables[R.value].text}" | "${s.syllables[R.value+1].text}" â†’ ${r.toFixed(3)}s`),s.syllables[R.value].endTime=r,s.syllables[R.value+1].startTime=r}const n=U(s);i[o]=n;const u=i.map(U);x("update:words",u)},te=()=>{N.value&&H.value[N.value]&&delete H.value[N.value],j.value=!1,N.value=null,document.removeEventListener("mousemove",ee),document.removeEventListener("mouseup",te),document.body.style.cursor="",document.body.style.userSelect=""};return s(async()=>{await l();const e=()=>{if(y.value){const e=y.value.clientWidth;e>0&&(_.value=e)}};e(),setTimeout(e,100),window.addEventListener("resize",e),d(()=>{window.removeEventListener("resize",e)})}),n([()=>r.viewStart,()=>r.viewEnd,()=>r.duration],()=>{l(()=>{if(y.value){const e=y.value.clientWidth;e>0&&e!==_.value&&(_.value=e)}})},{flush:"post"}),d(()=>{document.removeEventListener("mousemove",ee),document.removeEventListener("mouseup",te)}),(t,a)=>(p(),u("div",T,[m("div",{class:v(["timeline-track",{"with-background":e.showBackground,"with-border":e.showBorder}]),ref_key:"timelineTrack",ref:y},[a[0]||(a[0]=m("div",{class:"timeline-baseline"},null,-1)),(p(!0),u(c,null,f(X.value,e=>(p(),u("div",{key:e.id,class:v(["word-car",{selected:L.value===e.id,dragging:j.value&&N.value===e.id,untimed:0===e.startTime&&0===e.endTime}]),style:w(q(e)),onMousedown:t=>((e,t)=>{t.preventDefault(),L.value=e.id,x("select-word",e.id)})(e,t)},[m("div",k,h(e.text),1),m("div",{class:"hotspot hotspot-move",title:"Drag to move word",onMousedown:g(t=>Z("move",e,t),["stop"])},null,40,S),m("div",{class:"hotspot hotspot-resize-end",title:"Drag to adjust end time",onMousedown:g(t=>Z("resize",e,t),["stop"])},null,40,$),e.syllables&&e.syllables.length>1?(p(!0),u(c,{key:0},f(e.syllables.slice(0,-1),(t,a)=>(p(),u("div",{key:`syllable-${a}`,class:"hotspot hotspot-syllable-divider",style:w(G(e,a)),title:`Adjust syllable ${a+1}/${a+2} boundary`,onMousedown:g(t=>Z("syllable",e,t,a),["stop"])},null,44,z))),128)):b("",!0)],46,M))),128))],2),e.showDebug?(p(),u("div",E,[a[4]||(a[4]=m("h4",null,"Word Timing Editor Debug",-1)),m("p",null,"Timeline Duration: "+h(e.duration.toFixed(2))+"s",1),m("p",null," View Window: "+h(r.viewStart.toFixed(2))+"s - "+h(I.value.toFixed(2))+"s ("+h(J.value.toFixed(2))+"s span) ",1),m("p",null,"Pixels/Second: "+h(V.value.toFixed(1)),1),m("p",null,"Track Width: "+h(_.value)+"px",1),m("p",null,"Total Words: "+h(r.words.length)+" | Visible: "+h(X.value.length),1),m("p",null,"Selected Word: "+h(L.value||"None"),1),m("p",null,"Drag State: "+h(j.value?`${A.value} on ${N.value}`:"None"),1),j.value?(p(),u("p",W,"Drag Start Time: "+h(P.value.toFixed(3))+"s",1)):b("",!0),L.value?(p(),u("div",D,[a[3]||(a[3]=m("strong",null,"Selected Word Details:",-1)),m("div",O,[X.value.find(e=>e.id===L.value)?(p(),u("p",F,' Word: "'+h(X.value.find(e=>e.id===L.value)?.text)+'" | Start: '+h(X.value.find(e=>e.id===L.value)?.startTime.toFixed(3))+"s | Duration: "+h(K(X.value.find(e=>e.id===L.value)).toFixed(3))+"s ",1)):b("",!0),X.value.find(e=>e.id===L.value)?.syllables?(p(),u("div",B,[a[1]||(a[1]=m("strong",null,"Syllable Durations:",-1)),(p(!0),u(c,null,f(X.value.find(e=>e.id===L.value)?.syllables,(e,t)=>(p(),u("div",{key:t,class:"syllable-info"},' "'+h(e.text)+'": '+h(Q(e).toFixed(3))+"s ("+h((Q(e)/K(X.value.find(e=>e.id===L.value))*100).toFixed(1))+"%) ",1))),128))])):b("",!0)]),m("details",null,[a[2]||(a[2]=m("summary",null,"Raw JSON Data",-1)),m("pre",null,h(JSON.stringify(X.value.find(e=>e.id===L.value),null,2)),1)])])):b("",!0)])):b("",!0)]))}});e("W",x(L,[["__scopeId","data-v-a7e70df8"]]))}}});
//# sourceMappingURL=WordTimingEditor-legacy-6e8be2c8.js.map
