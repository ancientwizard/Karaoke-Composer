System.register(["./index-legacy-1803f8de.js","./lyricsParser-legacy-fd32a37b.js","./audioStorageService-legacy-297a1f4c.js","./WordTimingEditor-legacy-6e8be2c8.js"],function(e,a){"use strict";var t,i,l,s,n,o,r,d,c,u,m,v,p,b,g,f,y,h,w,k,x,T,S,M,C,A,F,$,P,D,L,E,z,I,j,W,R,N,U,B,q,_,V;return{setters:[e=>{t=e.d,i=e.r,l=e.c,s=e.a,n=e.b,o=e.n,r=e.t,d=e.F,c=e.e,u=e.g,m=e.i,v=e.z,p=e.o,b=e.w,g=e.h,f=e.A,y=e._,h=e.k,w=e.B,k=e.l,x=e.f,T=e.C,S=e.p,M=e.m,C=e.q,A=e.s,F=e.j,$=e.D,P=e.x,D=e.y,L=e.u},e=>{E=e.T,z=e.a,I=e.b,j=e.c,W=e.p,R=e.g,N=e.d,U=e.f,B=e.e},e=>{q=e.a},e=>{_=e.W,V=e.R}],execute:function(){var a=document.createElement("style");a.textContent='.lyrics-container[data-v-a03a354a]{height:400px;overflow-y:auto}.lyric-line[data-v-a03a354a]{display:flex;align-items:center;padding:.15rem;border-bottom:1px solid #f0f0f0;transition:all .2s ease;cursor:pointer}.lyric-line[data-v-a03a354a]:hover{background-color:#f8f9fa}.lyric-line.active[data-v-a03a354a]{background-color:#e3f2fd;border-left:4px solid #2196f3}.lyric-line.has-timing[data-v-a03a354a]{border-left:4px solid #4caf50}.lyric-line.timing-mode.active[data-v-a03a354a]{background-color:#fff3e0;border-left:4px solid #ff9800}.line-number[data-v-a03a354a]{min-width:40px;text-align:center;font-weight:700;color:#666;font-size:.875rem}.timing-display[data-v-a03a354a]{min-width:60px;text-align:center;font-family:Courier New,monospace}.lyric-text-container[data-v-a03a354a]{flex:1;padding:0 1rem}.lyric-text[data-v-a03a354a]{min-height:1.5rem;padding:.25rem 0}.empty-text[data-v-a03a354a]{color:#999;font-style:italic}.words-display[data-v-a03a354a]{display:flex;flex-wrap:wrap;gap:.5rem}.word-item[data-v-a03a354a]{display:inline-flex;padding:.125rem .25rem;border-radius:.25rem;transition:all .2s}.word-item.current-word[data-v-a03a354a]{background-color:#fff3cd;border:1px solid #ffc107}.word-item.timed-word[data-v-a03a354a]{background-color:#d1edff;border:1px solid #0d6efd}.syllable-item[data-v-a03a354a]{position:relative}.syllable-item[data-v-a03a354a]:not(:last-child):after{content:"Â·";color:#ccc;margin:0 1px}.syllable-item.timed-syllable[data-v-a03a354a]{color:#0d6efd;font-weight:500}.line-actions[data-v-a03a354a]{min-width:50px;display:flex;justify-content:flex-end}.empty-state[data-v-a03a354a]{min-height:200px;display:flex;align-items:center;justify-content:center}.editor-controls .btn.active[data-v-a03a354a]{background-color:#0d6efd;color:#fff}kbd[data-v-a03a354a]{background-color:#f8f9fa;border:1px solid #dee2e6;border-radius:.25rem;padding:.125rem .25rem;font-size:.75rem}.lyrics-container[data-v-a03a354a]::-webkit-scrollbar{width:8px}.lyrics-container[data-v-a03a354a]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:4px}.lyrics-container[data-v-a03a354a]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:4px}.lyrics-container[data-v-a03a354a]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.lyric-line.metadata-line[data-v-a03a354a]{background-color:#f8f9fa;border-left:3px solid #6c757d;opacity:.8}.lyric-line.metadata-line[data-v-a03a354a]:hover{opacity:1}.metadata-display[data-v-a03a354a]{color:#6c757d;font-style:italic;font-size:.9em}.metadata-text[data-v-a03a354a]{color:#6c757d!important}.preview-container[data-v-3e106210]{height:400px;overflow-y:auto;background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%)}.preview-container.karaoke-mode[data-v-3e106210]{background:#1a1a1a;color:#fff;text-align:center;display:flex;align-items:center;justify-content:center;padding:1rem}.font-small[data-v-3e106210]{font-size:.875rem}.font-medium[data-v-3e106210]{font-size:1rem}.font-large[data-v-3e106210]{font-size:1.25rem}.karaoke-display[data-v-3e106210]{width:100%;max-width:600px}.context-lines[data-v-3e106210]{margin:.5rem 0}.context-line[data-v-3e106210]{padding:.25rem 0;opacity:.6;font-size:.9em}.context-line.previous[data-v-3e106210]{color:#999}.context-line.next[data-v-3e106210]{color:#ccc}.current-line-display[data-v-3e106210]{padding:.7rem;border:1px solid #444;border-radius:1rem;background:rgba(255,255,255,.1);backdrop-filter:blur(10px);margin:1rem 0;transition:all .3s ease}.current-line-display.highlighted[data-v-3e106210]{border-color:gold;background:rgba(255,215,0,.2);transform:scale(1.05)}.current-line-display .line-text[data-v-3e106210]{font-size:1.3em;font-weight:700;display:block;margin-bottom:.5rem}.current-line-display .line-timing[data-v-3e106210]{font-size:.9em;color:gold}.karaoke-word[data-v-3e106210]{display:inline-block;margin:0 .25rem;transition:all .3s ease}.karaoke-word.current-word[data-v-3e106210]{color:gold;font-weight:700;text-shadow:0 0 10px rgba(255,215,0,.5);transform:scale(1.1)}.karaoke-word.past-word[data-v-3e106210]{color:#90ee90;opacity:.8}.karaoke-word.future-word[data-v-3e106210]{color:#ddd;opacity:.6}.karaoke-syllable[data-v-3e106210]{transition:all .2s ease}.karaoke-syllable.current-syllable[data-v-3e106210]{background:linear-gradient(135deg,#ffd700,#ffed4e);color:#000;padding:.1rem .2rem;border-radius:.25rem;animation:syllable-highlight-3e106210 .5s ease-in-out}.karaoke-syllable.past-syllable[data-v-3e106210]{color:#90ee90}.karaoke-syllable.future-syllable[data-v-3e106210]{color:#ccc}@keyframes syllable-highlight-3e106210{0%{transform:scale(1)}50%{transform:scale(1.2)}to{transform:scale(1)}}.normal-display[data-v-3e106210]{padding:.5rem;height:100%}.preview-line[data-v-3e106210]{padding:.5rem;margin:.125rem 0;border-radius:.375rem;transition:all .3s ease;border-left:4px solid transparent}.preview-line.current[data-v-3e106210]{background-color:rgba(33,150,243,.1);border-left-color:#2196f3}.preview-line.has-timing[data-v-3e106210]{border-left-color:#4caf50}.preview-line.playing[data-v-3e106210]{background-color:rgba(255,193,7,.2);border-left-color:#ffc107;animation:pulse-3e106210 1.5s ease-in-out infinite alternate}.preview-line.past[data-v-3e106210]{opacity:.7;color:#666}.preview-line.future[data-v-3e106210]{opacity:.8}.line-content[data-v-3e106210]{display:flex;align-items:center;gap:1rem}.line-number[data-v-3e106210]{min-width:30px;font-weight:700;color:#666;font-size:.875rem}.line-text[data-v-3e106210]{flex:1}.line-timing[data-v-3e106210]{font-family:Courier New,monospace;font-size:.875rem;color:#28a745;font-weight:700}.line-progress[data-v-3e106210]{height:3px;background-color:rgba(0,0,0,.1);border-radius:2px;margin-top:.5rem;overflow:hidden}.progress-bar[data-v-3e106210]{height:100%;background:linear-gradient(90deg,#ffc107,#ff9800);border-radius:2px;transition:width .1s linear}.empty-state[data-v-3e106210]{height:100%;display:flex;align-items:center;justify-content:center}.preview-controls .btn.active[data-v-3e106210]{background-color:#0d6efd;color:#fff}.btn-group .btn[data-v-3e106210]{min-width:32px}.btn-group .btn[data-v-3e106210]:nth-child(1){font-size:.75rem}.btn-group .btn[data-v-3e106210]:nth-child(2){font-size:.875rem}.btn-group .btn[data-v-3e106210]:nth-child(3){font-size:1rem}@keyframes pulse-3e106210{0%{transform:scale(1)}to{transform:scale(1.02)}}.preview-container[data-v-3e106210]::-webkit-scrollbar{width:8px}.preview-container[data-v-3e106210]::-webkit-scrollbar-track{background:rgba(0,0,0,.1);border-radius:4px}.preview-container[data-v-3e106210]::-webkit-scrollbar-thumb{background:rgba(0,0,0,.3);border-radius:4px}.preview-container[data-v-3e106210]::-webkit-scrollbar-thumb:hover{background:rgba(0,0,0,.5)}.context-line[data-v-3e106210],.current-line-display[data-v-3e106210],.normal-line[data-v-3e106210]{position:relative}.context-line[data-v-3e106210]:has(.line-text:contains("[@")),.current-line-display[data-v-3e106210]:has(.line-text:contains("[@")),.normal-line[data-v-3e106210]:has(.line-text:contains("[@")){opacity:.7;font-style:italic;color:#6c757d}.metadata-preview-line[data-v-3e106210]{opacity:.7;font-style:italic;color:#6c757d;border-left:3px solid #6c757d;padding-left:8px;margin-left:-8px}.karaoke-display[data-v-3e106210]{display:flex;flex-direction:column;min-height:400px;padding:1.8rem 1rem 1rem;text-align:center}.karaoke-position[data-v-3e106210]{x-vicb-border:1px solid #2196f3;min-height:1.2rem;display:flex;align-items:center;justify-content:center;margin:0rem;padding:0}.position-1[data-v-3e106210]{order:1}.position-2[data-v-3e106210]{order:2}.position-3[data-v-3e106210]{order:3}.display-title[data-v-3e106210]{font-size:1.4em;font-weight:700;color:#fff;text-shadow:2px 2px 4px rgba(0,0,0,.3)}.display-author[data-v-3e106210]{font-size:1.1em;color:#e0e0e0;font-style:italic;text-shadow:1px 1px 2px rgba(0,0,0,.3)}.display-caption[data-v-3e106210]{font-size:.9em;color:#b0b0b0;font-style:italic;text-shadow:1px 1px 2px rgba(0,0,0,.2);background:rgba(0,0,0,.2)}.current-line-display[data-v-3e106210]{order:4;margin:1rem 0;font-size:1.6em;font-weight:500;color:#fff;text-shadow:1px 1px 3px rgba(0,0,0,.5);min-height:4rem;display:flex;align-items:center;justify-content:center}.future-lines[data-v-3e106210]{order:5;margin-top:1rem}.future-line[data-v-3e106210]{font-size:.9em;color:#999;opacity:.6;margin-bottom:.5rem;text-shadow:1px 1px 2px rgba(0,0,0,.3)}.font-small .display-title[data-v-3e106210]{font-size:1.27em}.font-small .display-author[data-v-3e106210]{font-size:1.04em}.font-small .display-caption[data-v-3e106210]{font-size:.81em}.font-small .current-line-display[data-v-3e106210]{font-size:1.38em}.font-small .future-line[data-v-3e106210]{font-size:.81em}.font-large .display-title[data-v-3e106210]{font-size:2.13em}.font-large .display-author[data-v-3e106210]{font-size:1.53em}.font-large .display-caption[data-v-3e106210]{font-size:1.19em}.font-large .current-line-display[data-v-3e106210]{font-size:1.7em}.font-large .future-line[data-v-3e106210]{font-size:.94em}.waveform-container[data-v-d3d7a42c]{min-height:220px;position:relative;background:#f8f9fa;overflow-x:auto}.loading-state[data-v-d3d7a42c],.no-audio-state[data-v-d3d7a42c]{height:220px}.waveform-canvas-container[data-v-d3d7a42c]{margin-top:.5em;position:relative;padding:20px 10px 5px}.waveform-canvas[data-v-d3d7a42c]{display:block;cursor:crosshair;border:1px solid #dee2e6;background:white}.lyric-marker[data-v-d3d7a42c]{position:absolute;top:15px;height:124px;cursor:pointer;z-index:5}.marker-line[data-v-d3d7a42c]{width:2px;height:100%;background-color:#28a745;margin:0 auto}.marker-label[data-v-d3d7a42c]{position:absolute;top:-15px;left:50%;transform:translate(-50%);background:#28a745;color:#fff;padding:2px 6px;border-radius:3px;font-size:.75rem;font-weight:700;white-space:nowrap}.lyric-marker.active .marker-line[data-v-d3d7a42c]{background-color:#ffc107;width:3px}.lyric-marker.active .marker-label[data-v-d3d7a42c]{background-color:#ffc107;color:#000}.lyric-marker.selected .marker-line[data-v-d3d7a42c]{background-color:#007bff;width:3px}.lyric-marker.selected .marker-label[data-v-d3d7a42c]{background-color:#007bff}.selection-area[data-v-d3d7a42c]{position:absolute;top:20px;bottom:40px;background-color:rgba(0,123,255,.2);border:1px solid #007bff;pointer-events:none;z-index:3}.time-scale[data-v-d3d7a42c]{position:absolute;bottom:0;left:10px;right:10px;height:15px}.time-mark[data-v-d3d7a42c]{position:absolute;bottom:0}.time-mark-line[data-v-d3d7a42c]{width:1px;height:10px;background-color:#6c757d;margin:0 auto}.time-mark-label[data-v-d3d7a42c]{position:absolute;top:3px;left:50%;transform:translate(-50%);font-size:.75rem;color:#6c757d;white-space:nowrap}.zoom-level[data-v-d3d7a42c]{font-size:.875rem;color:#6c757d;min-width:50px;text-align:center}.controls-row[data-v-d3d7a42c]{min-height:38px}.controls-row[data-v-d3d7a42c]>*{flex-shrink:0}.player-controls .btn[data-v-d3d7a42c]{min-width:36px}.view-controls[data-v-d3d7a42c]{flex-wrap:wrap}@media (max-width: 768px){.controls-row[data-v-d3d7a42c]{flex-direction:column;gap:.75rem!important}.view-controls[data-v-d3d7a42c]{width:100%;justify-content:center}}.waveform-container[data-v-d3d7a42c]::-webkit-scrollbar{height:8px}.waveform-container[data-v-d3d7a42c]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:4px}.waveform-container[data-v-d3d7a42c]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:4px}.waveform-container[data-v-d3d7a42c]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.hotkey-item[data-v-f8f0e233]{display:flex;align-items:center;gap:.5rem;margin-bottom:.25rem}.hotkey-item kbd[data-v-f8f0e233]{font-size:.7rem;padding:.15rem .3rem;min-width:auto}.hotkey-item span[data-v-f8f0e233]{flex:1;font-size:.75rem}.timing-steps[data-v-f8f0e233]{background:rgba(0,0,0,.05);padding:.5rem;border-radius:.25rem;margin-top:.5rem;font-size:1.1rem}.small-steps[data-v-f8f0e233]{margin:.25rem 0 0 1rem;padding-left:0;line-height:1.3;font-size:.9rem}.timing-view[data-v-6a1b7887]{outline:none!important}.timing-view[data-v-6a1b7887]:focus,.timing-view[data-v-6a1b7887]:focus-visible{outline:none!important;box-shadow:none!important}.modal.show[data-v-6a1b7887]{display:block;background-color:rgba(0,0,0,.5)}.timing-header[data-v-6a1b7887]{border-radius:.5rem;border:1px solid #dee2e6}.timing-editor[data-v-6a1b7887]{min-height:80vh}.loading-screen[data-v-6a1b7887],.error-screen[data-v-6a1b7887]{min-height:60vh;display:flex;align-items:center;justify-content:center}.breadcrumb-item a[data-v-6a1b7887]{color:#6c757d}.breadcrumb-item a[data-v-6a1b7887]:hover{color:#0d6efd}.stat-item[data-v-6a1b7887]{padding:.5rem}.stat-number[data-v-6a1b7887]{font-size:1.25rem;font-weight:700;color:#0d6efd}.stat-label[data-v-6a1b7887]{font-size:.875rem}.full-width-layout[data-v-6a1b7887]{width:100vw;margin-left:calc(-50vw + 50%);padding:1rem 2rem;min-height:100vh}.flexible-layout[data-v-6a1b7887]{display:flex;gap:1.5rem;min-height:80vh;max-width:none}.sidebar-column[data-v-6a1b7887]{flex:0 0 320px;min-width:280px;max-width:400px}.main-content-column[data-v-6a1b7887]{flex:1;min-width:0}@media (max-width: 1200px){.sidebar-column[data-v-6a1b7887]{flex:0 0 280px;max-width:320px}}@media (max-width: 768px){.flexible-layout[data-v-6a1b7887]{flex-direction:column}.sidebar-column[data-v-6a1b7887]{flex:none;width:100%;max-width:none}}.card-header h6[data-v-6a1b7887]{font-size:.9rem;font-weight:600}.card-header small[data-v-6a1b7887]{font-size:.75rem}.btn-group-vertical .btn[data-v-6a1b7887]{border-radius:.25rem!important;margin-bottom:.25rem}.btn-group-vertical .btn[data-v-6a1b7887]:last-child{margin-bottom:0}\n',document.head.appendChild(a);const K=new class{audio=null;audioContext=null;source=null;analyser=null;gainNode=null;isInitialized=!1;updateTimer=null;fastMode=!1;playbackState={isPlaying:!1,currentTime:0,duration:0,volume:1,playbackRate:1,isLoaded:!1};timeUpdateCallback;playbackStateCallback;constructor(){this.initializeAudioContext()}async initializeAudioContext(){try{this.audioContext&&"closed"===this.audioContext.state&&(this.audioContext=null,this.analyser=null,this.gainNode=null,this.source=null,this.isInitialized=!1),this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=new AudioContext,this.analyser=this.audioContext.createAnalyser(),this.gainNode=this.audioContext.createGain(),this.analyser.fftSize=2048,this.analyser.connect(this.audioContext.destination),this.gainNode.connect(this.analyser),this.isInitialized=!0,console.log("Audio context initialized successfully")),"suspended"===this.audioContext.state&&(await this.audioContext.resume(),console.log("Audio context resumed"))}catch(e){console.error("Failed to initialize audio context:",e)}}async loadAudioFile(e){try{if(await this.initializeAudioContext(),this.audio&&(this.audio.pause(),this.audio.src=""),this.audio=new Audio,this.setupAudioEventListeners(),e.file){const a=URL.createObjectURL(e.file);this.audio.src=a}else{if(!e.url)throw new Error("No audio file or URL provided");this.audio.src=e.url}if(this.isInitialized&&this.audioContext&&this.gainNode)try{this.source&&this.source.disconnect(),this.source=this.audioContext.createMediaElementSource(this.audio),this.source.connect(this.gainNode),console.log("Audio source connected to Web Audio API")}catch(a){console.warn("Web Audio API connection failed, falling back to basic audio:",a)}await new Promise((e,a)=>{const t=()=>{this.audio.removeEventListener("canplaythrough",t),this.audio.removeEventListener("error",i),e()},i=e=>{this.audio.removeEventListener("canplaythrough",t),this.audio.removeEventListener("error",i),a(e)};this.audio.addEventListener("canplaythrough",t),this.audio.addEventListener("error",i),this.audio.load()}),this.playbackState.isLoaded=!0;const t=await this.detectAudioDuration(e);return this.playbackState.duration=t,this.updatePlaybackState(),!0}catch(t){return console.error("Failed to load audio file:",t),this.playbackState.isLoaded=!1,this.updatePlaybackState(),!1}}setupAudioEventListeners(){this.audio&&(this.audio.addEventListener("timeupdate",()=>{this.playbackState.currentTime=1e3*this.audio.currentTime,this.updatePlaybackState(),this.timeUpdateCallback&&this.timeUpdateCallback(this.playbackState.currentTime)}),this.audio.addEventListener("play",()=>{this.playbackState.isPlaying=!0,this.updatePlaybackState()}),this.audio.addEventListener("pause",()=>{this.playbackState.isPlaying=!1,this.updatePlaybackState()}),this.audio.addEventListener("ended",()=>{this.playbackState.isPlaying=!1,this.playbackState.currentTime=0,this.updatePlaybackState()}),this.audio.addEventListener("loadedmetadata",()=>{this.playbackState.duration=1e3*this.audio.duration,this.updatePlaybackState()}))}async play(){if(this.audio&&this.playbackState.isLoaded)try{await this.initializeAudioContext(),this.audioContext&&"suspended"===this.audioContext.state&&(await this.audioContext.resume(),console.log("Audio context resumed for playback")),await this.audio.play(),this.playbackState.isPlaying=!0,this.startUpdateTimer(),this.updatePlaybackState(),console.log("Audio playback started successfully")}catch(e){throw console.error("Failed to play audio:",e),e}}pause(){this.audio&&(this.audio.pause(),this.stopUpdateTimer())}stop(){this.audio&&(this.audio.pause(),this.audio.currentTime=0)}seek(e){this.audio&&this.playbackState.isLoaded&&(this.audio.currentTime=e/1e3,this.playbackState.currentTime=e,this.updatePlaybackState(),this.timeUpdateCallback&&this.timeUpdateCallback(e))}setVolume(e){this.audio&&(this.audio.volume=Math.max(0,Math.min(1,e)),this.playbackState.volume=this.audio.volume),this.gainNode&&(this.gainNode.gain.value=this.playbackState.volume),this.updatePlaybackState()}setPlaybackRate(e){this.audio&&(this.audio.playbackRate=Math.max(.25,Math.min(4,e)),this.playbackState.playbackRate=this.audio.playbackRate),this.updatePlaybackState()}getPlaybackState(){return{...this.playbackState}}onTimeUpdate(e){this.timeUpdateCallback=e}onPlaybackStateChange(e){this.playbackStateCallback=e}setFastMode(e){this.fastMode=e,this.playbackState.isPlaying&&(this.stopUpdateTimer(),this.startUpdateTimer());const a=e?"12Hz":"8Hz",t=e?"~83ms":"~125ms";console.log(`ðŸ”„ Refresh rate: ${a} (${t} intervals) - ${e?"FAST MODE":"Normal mode"}`)}toggleFastMode(){this.setFastMode(!this.fastMode)}getFastMode(){return this.fastMode}startUpdateTimer(){this.updateTimer&&clearInterval(this.updateTimer);const e=E.getPlaybackUpdateInterval(this.fastMode);this.updateTimer=window.setInterval(()=>{if(this.audio&&this.playbackState.isPlaying){const e=1e3*this.audio.currentTime;this.playbackState.currentTime=e,this.timeUpdateCallback&&this.timeUpdateCallback(e)}},e)}stopUpdateTimer(){this.updateTimer&&(clearInterval(this.updateTimer),this.updateTimer=null)}updatePlaybackState(){this.playbackStateCallback&&this.playbackStateCallback({...this.playbackState})}getFrequencyData(){if(!this.analyser)return null;const e=new Uint8Array(this.analyser.frequencyBinCount);return this.analyser.getByteFrequencyData(e),e}getTimeDomainData(){if(!this.analyser)return null;const e=new Uint8Array(this.analyser.frequencyBinCount);return this.analyser.getByteTimeDomainData(e),e}async generateWaveformData(e=1e3){if(!this.audio||!this.audioContext)return null;try{const a=await fetch(this.audio.src),t=await a.arrayBuffer(),i=(await this.audioContext.decodeAudioData(t)).getChannelData(0),l=Math.floor(i.length/e),s=[];for(let n=0;n<e;n++){const e=n*l,a=e+l;let t=0;for(let l=e;l<a;l++)t=Math.max(t,Math.abs(i[l]));s.push(t)}return s}catch(a){return console.error("Failed to generate waveform data:",a),null}}async detectAudioDuration(e){if(e.duration&&e.duration>0)return console.log("âœ… Using stored duration:",e.duration/1e3,"seconds"),e.duration;if(this.audio&&isFinite(this.audio.duration)&&this.audio.duration>0)return console.log("ðŸ“ Duration from HTML5 audio:",this.audio.duration,"seconds"),1e3*this.audio.duration;console.log("â³ HTML5 duration invalid, using Web Audio API to detect duration...");try{const a=await this.fileToArrayBuffer(e);if(!this.audioContext)throw new Error("AudioContext not initialized");const t=await this.audioContext.decodeAudioData(a),i=1e3*t.duration;return console.log("ðŸŽµ Duration detected via Web Audio API:",t.duration,"seconds"),i}catch(a){return console.error("âŒ Failed to detect audio duration:",a),console.warn("âš ï¸ Using fallback duration of 3 minutes - waveform scrolling may not work correctly"),18e4}}async fileToArrayBuffer(e){if(e.file)return await e.file.arrayBuffer();if(e.url){const a=await fetch(e.url);return await a.arrayBuffer()}throw new Error("No audio file or URL available")}dispose(){this.audio&&(this.audio.pause(),this.audio.src=""),this.source&&this.source.disconnect(),this.audioContext&&this.audioContext.close(),this.timeUpdateCallback=void 0,this.playbackStateCallback=void 0}};function H(e,a,t){const i=/[,;]$/.test(e),l=/[.!?]$/.test(e),s=!!a&&/^[A-Z]/.test(a);return l||s?{hasRest:!0,restType:"phrase",estimatedRestDuration:z.musical.restDuration.period}:i?{hasRest:!0,restType:"comma",estimatedRestDuration:z.musical.restDuration.comma}:t&&t>1e3?{hasRest:!0,restType:"breath",estimatedRestDuration:Math.min(.3*t,z.musical.restDuration.breath)}:{hasRest:!1,restType:"breath",estimatedRestDuration:0}}function O(e,a,t,i,l={},s=!1,n=!1){if(0===e.syllables.length)return;const o=H(e.word,i,t);let r=t-o.estimatedRestDuration;if(n&&void 0!==e.endTime&&void 0!==e.startTime){const a=e.endTime-e.startTime;r=Math.min(r,a),console.log(`ðŸŽµ Constraining "${e.word}" to existing duration: ${a}ms`)}const d=function(e,a,t={}){const{estimatedBeatDuration:i=500}=t,l={eighth:i/2,quarter:i,half:2*i,whole:4*i};if(1===e)return a>l.half?[{type:"half",duration:l.half}]:a>l.quarter?[{type:"quarter",duration:l.quarter}]:[{type:"eighth",duration:l.eighth}];if(2===e)return a/2>l.quarter?[{type:"quarter",duration:l.quarter},{type:"quarter",duration:l.quarter}]:[{type:"eighth",duration:l.eighth},{type:"quarter",duration:l.quarter}];if(3===e)return[{type:"eighth",duration:l.eighth},{type:"eighth",duration:l.eighth},{type:"quarter",duration:l.quarter}];const s=a/e>l.quarter?"quarter":"eighth";return Array(e).fill(null).map(()=>({type:s,duration:l[s]}))}(e.syllables.length,r,l);let c=a;e.syllables.forEach((e,a)=>{const t=d[a]||d[d.length-1];e.startTime=c,e.endTime=c+t.duration,e.duration=t.duration,c=e.endTime}),e.startTime=a,n?console.log(`ðŸŽµ Preserving word boundaries for "${e.word}": ${e.startTime}-${e.endTime}`):(e.endTime=c,e.duration=c-a),s||console.log(`ðŸŽµ Musical timing: "${e.word}" uses ${e.duration}ms of ${t}ms available`+(o.hasRest?` (${o.estimatedRestDuration}ms rest reserved)`:""))}function G(e,a={}){const{preserveWordTiming:t=!0,onlyProcessUntimedSyllables:i=!0}=a,l=function(e){let a=0,t=0,i=0;for(const o of e)for(let e=0;e<o.words.length;e++){const l=o.words[e];if(void 0!==l.startTime&&void 0!==l.endTime){a++,t+=l.endTime-l.startTime;const s=o.words[e+1];if(void 0!==s?.startTime){const e=s.startTime-l.endTime;H(l.word,s.word,e).hasRest&&i++}}}const l=a>0?t/a:500,s=a>0?6e4/l:120;let n="poor";return a>10&&i>2&&(n="good"),a>20&&i>5&&(n="excellent"),{totalWords:a,avgWordDuration:l,estimatedBPM:Math.max(80,Math.min(200,s)),detectedRests:i,timingQuality:n}}(e);console.log(`ðŸŽµ Song Analysis: ${l.totalWords} words, ${l.estimatedBPM.toFixed(0)} BPM, ${l.detectedRests} rests (${l.timingQuality} quality)`);const s={bpm:l.estimatedBPM,timeSignature:[4,4],estimatedBeatDuration:6e4/l.estimatedBPM};for(const n of e)for(let e=0;e<n.words.length;e++){const a=n.words[e];if(void 0!==a.startTime){if(i&&a.syllables.some(e=>void 0!==e.startTime)){console.log(`ðŸŽµ Skipping "${a.word}" - already has syllable timing`);continue}let l=1e3;const o=n.words[e+1];void 0!==o?.startTime&&(l=o.startTime-a.startTime);const r=o?.word;if(t&&void 0!==a.endTime){const e=a.endTime-a.startTime;O(a,a.startTime,e,r,s,!1,!0)}else{const e=Math.min(l*z.musical.conservativeMultiplier,z.autoTiming.maxPhraseBreakDuration);O(a,a.startTime,e,r,s,!1,!1)}}}return l}const J={class:"lyrics-editor"},X={class:"card"},Q={class:"card-header d-flex justify-content-between align-items-center"},Z={class:"editor-controls"},Y={class:"card-body p-0"},ee=["onClick"],ae={class:"line-number"},te={class:"timing-display"},ie={key:0,class:"text-success"},le={key:1,class:"text-info"},se={key:2,class:"text-muted"},ne={class:"lyric-text-container"},oe=["onUpdate:modelValue"],re=["onUpdate:modelValue"],de=["onDblclick"],ce={key:0,class:"metadata-display"},ue={key:1,class:"words-display"},me={key:2,class:"empty-text"},ve={class:"line-actions"},pe=["onClick"],be=["onClick"],ge={key:0,class:"empty-state text-center py-4"},fe={class:"card-footer"},ye={class:"row align-items-center"},he={class:"col-sm-6"},we={class:"text-muted"},ke={class:"col-sm-6 text-end"},xe={key:0,class:"text-muted"},Te={key:1,class:"text-muted"},Se=t({__name:"LyricsEditor",props:{lyrics:{},currentLine:{},currentWord:{},isTimingMode:{type:Boolean}},emits:["line-select","lyrics-update"],setup(e,{emit:a}){const t=e,y=a,h=i(-1),w=i(),k=i(),x=l(()=>t.lyrics.filter(e=>void 0!==e.startTime).length),T=e=>void 0!==e.type&&"lyrics"!==e.type,S=()=>{const e=I("",t.lyrics.length+1,`line-${Date.now()}`),a=[...t.lyrics,e];F(a),y("lyrics-update",a),v(()=>{M(a.length-1)})},M=e=>{t.isTimingMode||(h.value=e,v(()=>{const e=k.value?.[0];e&&(e.focus(),e.select())}))},C=()=>{if(h.value>=0){const e=[...t.lyrics],a=e[h.value];if(a){const t=I(a.text,a.lineNumber,a.id);t.startTime=a.startTime,t.endTime=a.endTime,t.duration=a.duration,e[h.value]=t,y("lyrics-update",e)}}h.value=-1},A=()=>{h.value=-1},F=e=>{e.forEach((e,a)=>{e.lineNumber=a+1})},$=e=>{const a=Math.floor(e/1e3);return`${Math.floor(a/60)}:${(a%60).toString().padStart(2,"0")}`},P=e=>{t.isTimingMode&&("Space"===e.code?e.preventDefault():"ArrowUp"===e.code?(e.preventDefault(),t.currentLine>0&&y("line-select",t.currentLine-1)):"ArrowDown"===e.code&&(e.preventDefault(),t.currentLine<t.lyrics.length-1&&y("line-select",t.currentLine+1)))};return"undefined"!=typeof window&&window.addEventListener("keydown",P),(a,i)=>(p(),s("div",J,[n("div",X,[n("div",Q,[i[1]||(i[1]=n("h5",{class:"mb-0"},"ðŸ“ Lyrics Editor",-1)),n("div",Z,[n("button",{class:"btn btn-sm btn-outline-primary me-2",onClick:S,title:"Add new line"},[...i[0]||(i[0]=[n("i",{class:"bi bi-plus"},null,-1)])]),n("span",{class:o(["badge",e.isTimingMode?"bg-success":"bg-secondary"])},r(e.isTimingMode?"Timing Mode":"Editing Ready"),3)])]),n("div",Y,[n("div",{class:"lyrics-container",ref_key:"lyricsContainer",ref:w},[(p(!0),s(d,null,c(e.lyrics,(a,l)=>(p(),s("div",{key:a.id,class:o(["lyric-line",{active:l===e.currentLine,"has-timing":void 0!==a.startTime,"timing-mode":e.isTimingMode,"metadata-line":T(a)}]),onClick:e=>(e=>{y("line-select",e)})(l)},[n("div",ae,r(a.lineNumber),1),n("div",te,[void 0!==a.startTime?(p(),s("small",ie,r($(a.startTime)),1)):T(a)?(p(),s("small",le," META ")):(p(),s("small",se,"--:--"))]),n("div",ne,[h.value!==l||T(a)?h.value===l&&T(a)?b((p(),s("input",{key:1,type:"text",class:"form-control form-control-sm","onUpdate:modelValue":e=>a.text=e,onBlur:C,onKeyup:[f(C,["enter"]),f(A,["esc"])],ref_for:!0,ref_key:"editInput",ref:k,placeholder:"[@TITLE:], [@AUTHOR:], or [@CAPTION:]"},null,40,re)),[[g,a.text]]):(p(),s("div",{key:2,class:o(["lyric-text",{empty:!a.text.trim(),"metadata-text":T(a)}]),onDblclick:e=>M(l)},[T(a)?(p(),s("div",ce,[i[2]||(i[2]=n("i",{class:"bi bi-tag me-1"},null,-1)),m(r(a.text),1)])):a.words.length>0?(p(),s("div",ue,[(p(!0),s(d,null,c(a.words,(a,t)=>(p(),s("span",{key:t,class:o(["word-item",{"current-word":l===e.currentLine&&t===e.currentWord,"timed-word":void 0!==a.startTime}])},[(p(!0),s(d,null,c(a.syllables,(e,a)=>(p(),s("span",{key:a,class:o(["syllable-item",{"timed-syllable":void 0!==e.startTime}])},r(e.syllable),3))),128))],2))),128))])):(p(),s("div",me,"Empty line - double click to edit"))],42,de)):b((p(),s("input",{key:0,type:"text",class:"form-control form-control-sm","onUpdate:modelValue":e=>a.text=e,onBlur:C,onKeyup:[f(C,["enter"]),f(A,["esc"])],ref_for:!0,ref_key:"editInput",ref:k,placeholder:"Use / to separate syllables: Hel/lo world a/maz/ing"},null,40,oe)),[[g,a.text]])]),n("div",ve,[e.isTimingMode?u("",!0):(p(),s("button",{key:0,class:"btn btn-sm btn-outline-danger",onClick:e=>(e=>{if(confirm("Are you sure you want to delete this line?")){const a=t.lyrics.filter((a,t)=>t!==e);F(a),y("lyrics-update",a)}})(l),title:"Delete line"},[...i[3]||(i[3]=[n("i",{class:"bi bi-trash3"},null,-1)])],8,pe)),e.isTimingMode&&void 0!==a.startTime&&!T(a)?(p(),s("button",{key:1,class:"btn btn-sm btn-outline-warning",onClick:e=>(e=>{const a=t.lyrics.length-e;if(confirm(1===a?"Clear timing for this line?":`Clear timing for this line and ${a-1} lines after it?\n\nThis prevents timing inconsistencies by clearing all subsequent timing.`)){const a=j(t.lyrics,e);y("lyrics-update",a)}})(l),title:"Clear timing"},[...i[4]||(i[4]=[n("i",{class:"bi bi-clock-history"},null,-1)])],8,be)):u("",!0)])],10,ee))),128)),0===e.lyrics.length?(p(),s("div",ge,[...i[5]||(i[5]=[n("p",{class:"text-muted"},'No lyrics yet. Click "+" to add your first line.',-1)])])):u("",!0)],512)]),n("div",fe,[n("div",ye,[n("div",he,[n("small",we,r(e.lyrics.length)+" lines â€¢ "+r(x.value)+"/"+r(e.lyrics.length)+" timed ",1)]),n("div",ke,[e.isTimingMode?(p(),s("small",xe,[...i[6]||(i[6]=[m(" Press ",-1),n("kbd",null,"Space",-1),m(" to assign timing to current line ",-1)])])):(p(),s("small",Te," Double-click to edit lyrics "))])])])])]))}}),Me=y(Se,[["__scopeId","data-v-a03a354a"]]),Ce={class:"lyrics-preview"},Ae={class:"card"},Fe={class:"card-header d-flex justify-content-between align-items-center"},$e={class:"preview-controls"},Pe={class:"btn-group",role:"group"},De={key:0,class:"empty-state text-center py-4"},Le={key:0,class:"karaoke-display"},Ee={class:"karaoke-position position-1"},ze={key:0,class:"display-title"},Ie={key:1,class:"display-caption"},je={class:"karaoke-position position-2"},We={key:0,class:"display-author"},Re={key:1,class:"display-caption"},Ne={class:"karaoke-position position-3"},Ue={key:0,class:"display-caption"},Be={class:"line-text"},qe={class:"future-lines"},_e={key:1,class:"normal-display"},Ve={class:"line-content"},Ke={class:"line-number"},He={class:"line-text"},Oe={key:0,class:"line-timing"},Ge={key:0,class:"line-progress"},Je={class:"card-footer"},Xe={class:"row align-items-center"},Qe={class:"col-sm-6"},Ze={class:"text-muted"},Ye={key:0},ea={class:"col-sm-6 text-end"},aa={class:"text-muted"},ta={key:0},ia=y(t({__name:"LyricsPreview",props:{lyrics:{},currentTime:{},currentLine:{},currentWord:{},currentSyllable:{}},setup(e){const a=e,t=i(!0),b=i("medium"),g=i(),f=l(()=>a.lyrics[a.currentLine]||null),y=l(()=>{if(!f.value||void 0===f.value.startTime)return!1;const e=f.value.startTime,t=f.value.endTime||e+(f.value.duration||3e3);return a.currentTime>=e&&a.currentTime<=t}),k=l(()=>a.lyrics.filter(e=>void 0!==e.startTime).length),x=l(()=>0===a.lyrics.length?0:Math.round(k.value/a.lyrics.length*100)),T=l(()=>{const e=a.lyrics.map(e=>e.text).join("\n"),{metadata:t}=W(e);return t}),S=l(()=>T.value.title||null),M=l(()=>T.value.author||null),C=l(()=>{const e=a.lyrics.filter(e=>"caption"===e.type);if(0===e.length)return null;let t=null;for(let i=0;i<e.length;i++){const l=e[i];if(!(a.lyrics.findIndex(e=>e.id===l.id)<=a.currentLine))break;t=l.metadata?.caption||l.text.replace(/^\[@CAPTION:\s*/,"").replace(/\]$/,"")}return t}),A=l(()=>S.value?{type:"title",text:S.value}:C.value?{type:"caption",text:C.value}:{type:"empty",text:""}),F=l(()=>M.value?{type:"author",text:M.value}:C.value&&"title"===A.value.type?{type:"caption",text:C.value}:{type:"empty",text:""}),$=l(()=>C.value&&"title"===A.value.type&&"author"===F.value.type?{type:"caption",text:C.value}:{type:"empty",text:""}),P=l(()=>a.lyrics.slice(a.currentLine+1).filter(e=>!e.type||"lyrics"===e.type).slice(0,1)),D=()=>{t.value=!t.value},L=e=>{b.value=e},E=e=>{if(void 0===e.startTime)return!1;const t=e.startTime,i=e.endTime||t+(e.duration||3e3);return a.currentTime>=t&&a.currentTime<=i},z=e=>{if(!e.startTime||!e.duration)return 0;const t=(a.currentTime-e.startTime)/e.duration*100;return Math.max(0,Math.min(100,t))},I=e=>{const a=Math.floor(e/1e3);return`${Math.floor(a/60)}:${(a%60).toString().padStart(2,"0")}`},j=e=>e.type&&"lyrics"!==e.type?e.text:e.words&&e.words.length>0?e.words.map(e=>e.word).join(" "):e.text||"",R=(e,t)=>{const i=e.words[t];return!!i?.endTime&&a.currentTime>i.endTime},N=(e,t)=>{const i=e.words[t];return!!i?.startTime&&a.currentTime<i.startTime},U=e=>!!e?.endTime&&a.currentTime>e.endTime,B=e=>!!e?.startTime&&a.currentTime<e.startTime;return h(()=>a.currentLine,()=>{t.value||v(()=>{const e=g.value;if(e){const a=e.querySelector(".preview-line.current");a&&a.scrollIntoView({behavior:"smooth",block:"center"})}})}),(a,i)=>(p(),s("div",Ce,[n("div",Ae,[n("div",Fe,[i[4]||(i[4]=n("h5",{class:"mb-0"},"ðŸ‘ï¸ Lyrics Preview",-1)),n("div",$e,[n("button",{class:o(["btn btn-sm btn-outline-secondary me-2",{active:t.value}]),onClick:D,title:"Toggle karaoke mode"},[...i[3]||(i[3]=[n("i",{class:"bi bi-display"},null,-1)])],2),n("div",Pe,[n("button",{class:o(["btn btn-sm btn-outline-primary",{active:"small"===b.value}]),onClick:i[0]||(i[0]=e=>L("small"))}," A ",2),n("button",{class:o(["btn btn-sm btn-outline-primary",{active:"medium"===b.value}]),onClick:i[1]||(i[1]=e=>L("medium"))}," A ",2),n("button",{class:o(["btn btn-sm btn-outline-primary",{active:"large"===b.value}]),onClick:i[2]||(i[2]=e=>L("large"))}," A ",2)])])]),n("div",{class:o(["card-body preview-container",[`font-${b.value}`,{"karaoke-mode":t.value}]])},[0===e.lyrics.length?(p(),s("div",De,[...i[5]||(i[5]=[n("p",{class:"text-muted"},"No lyrics to preview",-1)])])):(p(),s("div",{key:1,class:"lyrics-display",ref_key:"lyricsDisplay",ref:g},[t.value?(p(),s("div",Le,[n("div",Ee,["title"===A.value.type?(p(),s("div",ze,r(A.value.text),1)):"caption"===A.value.type?(p(),s("div",Ie,r(A.value.text),1)):u("",!0)]),n("div",je,["author"===F.value.type?(p(),s("div",We,r(F.value.text),1)):"caption"===F.value.type?(p(),s("div",Re,r(F.value.text),1)):u("",!0)]),n("div",Ne,["caption"===$.value.type?(p(),s("div",Ue,r($.value.text),1)):u("",!0)]),!f.value||f.value.type&&"lyrics"!==f.value.type?u("",!0):(p(),s("div",{key:0,class:o(["current-line-display",{highlighted:y.value}])},[n("div",Be,[(p(!0),s(d,null,c(f.value.words,(a,t)=>(p(),s("span",{key:t,class:o(["karaoke-word",{"current-word":t===e.currentWord,"past-word":R(f.value,t),"future-word":N(f.value,t)}])},[(p(!0),s(d,null,c(a.syllables,(a,i)=>(p(),s("span",{key:i,class:o(["karaoke-syllable",{"current-syllable":t===e.currentWord&&i===e.currentSyllable,"past-syllable":U(a),"future-syllable":B(a)}])},r(a.syllable),3))),128)),i[6]||(i[6]=m(" "+r(" "),-1))],2))),128))])],2)),n("div",qe,[(p(!0),s(d,null,c(P.value,e=>(p(),s("div",{key:`future-${e.id}`,class:"future-line"},r(j(e)),1))),128))])])):(p(),s("div",_e,[(p(!0),s(d,null,c(e.lyrics,(a,t)=>(p(),s("div",{key:a.id,class:o(["preview-line",{current:t===e.currentLine,"has-timing":void 0!==a.startTime,past:void 0!==a.startTime&&a.startTime<e.currentTime,future:void 0!==a.startTime&&a.startTime>e.currentTime,playing:E(a)}])},[n("div",Ve,[n("span",Ke,r(a.lineNumber),1),n("span",He,r(j(a)),1),void 0!==a.startTime?(p(),s("span",Oe,r(I(a.startTime)),1)):u("",!0)]),E(a)&&a.duration?(p(),s("div",Ge,[n("div",{class:"progress-bar",style:w({width:z(a)+"%"})},null,4)])):u("",!0)],2))),128))]))],512))],2),n("div",Je,[n("div",Xe,[n("div",Qe,[n("small",Ze,[m(" Line "+r(e.currentLine+1)+" of "+r(e.lyrics.length)+" ",1),e.currentTime>0?(p(),s("span",Ye," â€¢ "+r(I(e.currentTime)),1)):u("",!0)])]),n("div",ea,[n("small",aa,[m(r(k.value)+"/"+r(e.lyrics.length)+" lines timed ",1),x.value>0?(p(),s("span",ta,"("+r(x.value)+"%)",1)):u("",!0)])])])])])]))}}),[["__scopeId","data-v-3e106210"]]),la={class:"waveform-viewer"},sa={class:"card"},na={class:"card-header"},oa={class:"d-flex justify-content-between align-items-center mb-2"},ra={class:"d-flex align-items-center"},da={key:0,class:"mode-indicator me-3"},ca={key:1,class:"loading-spinner me-2"},ua={class:"controls-row d-flex justify-content-between align-items-center flex-wrap gap-2"},ma={class:"player-controls d-flex align-items-center gap-2"},va=["disabled"],pa={class:"view-controls d-flex align-items-center gap-2"},ba={class:"btn-group",role:"group"},ga={key:0,class:"zoom-controls d-flex align-items-center"},fa=["disabled"],ya={class:"zoom-level mx-2"},ha=["disabled"],wa={key:1,class:"window-controls d-flex align-items-center gap-2"},ka={key:0,class:"progress-container mt-2"},xa={class:"time-display d-flex justify-content-between mt-1"},Ta={class:"text-muted"},Sa={class:"text-muted"},Ma={class:"card-body p-0"},Ca={key:0,class:"loading-state d-flex align-items-center justify-content-center"},Aa={key:1,class:"no-audio-state d-flex align-items-center justify-content-center"},Fa={key:2},$a=["width","height"],Pa=["onClick","onMousedown","title"],Da={class:"marker-label"},La={class:"time-scale"},Ea={class:"time-mark-label"},za={class:"card-footer"},Ia={class:"row align-items-center"},ja={class:"col-sm-4"},Wa={class:"text-muted"},Ra={key:0},Na={key:1},Ua={class:"col-sm-4 text-center"},Ba={class:"text-muted"},qa={class:"col-sm-4 text-end"},_a={class:"text-muted"},Va={key:0},Ka={key:1},Ha=t({__name:"WaveformViewer",props:{audioFile:{},lyrics:{},currentTime:{},waveformData:{},currentLineIndex:{default:0},playbackState:{},isTimingMode:{type:Boolean,default:!1}},emits:["seek","lyrics-position","selection","play-pause","skip-backward","skip-forward","view-window-change"],setup(e,{emit:a}){const t=e,g=a,f=i(),y=i(),S=i(!1),M=i(null),C=i(1),A=i(800),F=i(120),$=i(null),P=i(null),D=i(!1),L=i(-1),E=i([]),z=i("window"),I=i(15e3),j=i(0),W=i(!0),R=l(()=>t.lyrics.filter(e=>void 0!==e.startTime).map(e=>({...e,position:V(e.startTime)}))),N=l(()=>t.lyrics.filter(e=>void 0!==e.startTime).length),U=l(()=>t.playbackState&&t.audioFile?.duration?Math.min(t.currentTime/t.audioFile.duration*100,100):0),B=l(()=>{if(null!==$.value&&null!==P.value){const e=K(Math.min($.value,P.value));return K(Math.max($.value,P.value))-e}return 0}),q=l(()=>null!==$.value&&null!==P.value?{left:Math.min($.value,P.value)+"px",width:Math.abs(P.value-$.value)+"px"}:{}),_=l(()=>{if(!t.audioFile?.duration)return[];const e=[];if("window"===z.value){const a=Math.floor(j.value),t=I.value,i=a+t,l=t>3e4?5e3:2e3;for(let s=Math.ceil(a/l)*l;s<=i;s+=l)if(s>=a){const i=(s-a)/t;i>=0&&i<=1&&e.push({time:s,position:i*A.value,label:se(s)})}}else{const a=t.audioFile.duration,i=a>6e4?1e4:5e3;for(let t=0;t<=a;t+=i)e.push({time:t,position:V(t),label:se(t)})}return e}),V=e=>t.audioFile?.duration?e/t.audioFile.duration*A.value*C.value:0,K=e=>t.audioFile?.duration?e/(A.value*C.value)*t.audioFile.duration:0,H=e=>{if(D.value)return;const a=y.value.getBoundingClientRect(),t=e.clientX-a.left,i=K(t);g("seek",i)},O=e=>{if(e.target!==y.value)return;const a=y.value.getBoundingClientRect(),t=e.clientX-a.left;$.value=t,P.value=t},G=e=>{if(null===$.value)return;const a=y.value.getBoundingClientRect(),t=e.clientX-a.left;P.value=t},J=()=>{if(null!==$.value&&null!==P.value){const e=K(Math.min($.value,P.value)),a=K(Math.max($.value,P.value));Math.abs(P.value-$.value)>5&&g("selection",e,a)}setTimeout(()=>{$.value=null,P.value=null},2e3)},X=()=>{C.value<5&&(C.value+=.5,le())},Q=()=>{C.value>1&&(C.value-=.5,le())},Z=e=>{z.value=e,"window"===e&&(C.value=1,te()),le(),ae()},Y=()=>{te(),le(),ae()},ee=()=>{W.value=!W.value},ae=()=>{if("window"===z.value){const e=j.value/1e3,a=(j.value+I.value)/1e3;g("view-window-change",e,a,"window")}else{const e=t.audioFile?.duration||6e4;g("view-window-change",0,e/1e3,"full")}},te=()=>{if("window"===z.value){const e=I.value/2;W.value&&t.currentTime>0?t.currentTime<=e?j.value=0:j.value=Math.max(0,t.currentTime-e):j.value=0}ae()},ie=e=>{if(!t.audioFile?.duration)return;const a=e.currentTarget.getBoundingClientRect(),i=(e.clientX-a.left)/a.width*t.audioFile.duration;g("seek",i)},le=async()=>{const e=y.value,a=t.waveformData||M.value;if(!e||!a)return;const i=e.getContext("2d");if(!i)return;i.clearRect(0,0,e.width,e.height);const{peaks:l}=a,s=e.width,n=e.height;let o=l,r=0;if("window"===z.value){const e=a.duration||t.audioFile?.duration||1,i=j.value/e,s=I.value/e;r=Math.floor(i*l.length);const n=Math.min(Math.floor((i+s)*l.length),l.length);if(o=l.slice(r,n),0===o.length){const e=Math.min(Math.floor(.2*l.length),l.length);o=l.slice(0,e)}}const d=s/o.length;i.fillStyle="#3b82f6",i.strokeStyle="#1d4ed8";const c="window"===z.value?Math.max(1,Math.ceil(o.length/(2*s))):Math.max(1,Math.ceil(o.length/(s*C.value*2)));for(let t=0;t<o.length;t+=c){const e=Math.abs(o[t]),a=3,l=Math.min(e*n*a,.95*n),r="window"===z.value?t/o.length*s:t/o.length*s*C.value,u=n-l,m="window"===z.value?Math.max(1,s/o.length*c):Math.max(1,d*C.value);l>1&&i.fillRect(r,u,m,l)}if(i.strokeStyle="#6b7280",i.lineWidth=1,i.beginPath(),i.moveTo(0,n-1),i.lineTo(s,n-1),i.stroke(),void 0!==t.currentTime){const e=a.duration||t.audioFile?.duration;if(e){let a;if("window"===z.value){const i=I.value/2,l=e-i;a=t.currentTime<=i?t.currentTime/I.value*s:t.currentTime>=l?s-(e-t.currentTime)/I.value*s:s/2}else a=t.currentTime/e*s*C.value;a>=0&&a<=s&&(i.strokeStyle="#ef4444",i.lineWidth=3,i.beginPath(),i.moveTo(a,0),i.lineTo(a,n),i.stroke())}}},se=e=>{const a=Math.floor(e/1e3);return`${Math.floor(a/60)}:${(a%60).toString().padStart(2,"0")}`},ne=()=>{f.value&&(A.value=f.value.clientWidth-20)};return h(()=>t.audioFile,()=>{t.audioFile?.file&&(async()=>{if(t.audioFile?.file){S.value=!0;try{const e=new AudioContext,a=await t.audioFile.file.arrayBuffer(),i=await e.decodeAudioData(a),l=i.getChannelData(0),s=8e3,n=Math.floor(l.length/s),o=[];let r=0;for(let t=0;t<l.length;t++)r=Math.max(r,Math.abs(l[t]));for(let t=0;t<s;t++){const e=t*n,a=e+n;let i=0;for(let t=e;t<a;t++)i=Math.max(i,Math.abs(l[t]));o.push(r>0?i/r:0)}M.value={peaks:o,sampleRate:i.sampleRate,duration:i.duration,channels:i.numberOfChannels},"window"===z.value&&te(),v(()=>{le()})}catch(e){console.error("Error generating waveform:",e)}finally{S.value=!1}}})()},{immediate:!0}),h(()=>t.waveformData,()=>{t.waveformData&&v(()=>{le()})}),h(()=>M.value,()=>{M.value&&v(()=>{le()})}),h(()=>t.currentTime,(e,a)=>{if("window"===z.value&&void 0!==e&&t.audioFile?.duration){const i=I.value/2,l=void 0!==a&&Math.abs(e-a)>2e3;if(W.value||l){const a=t.audioFile.duration-i;j.value=e<=i?0:e>=a?Math.max(0,t.audioFile.duration-I.value):Math.max(0,Math.min(e-i,t.audioFile.duration-I.value)),ae()}}v(()=>{le()})}),k(()=>{ne(),window.addEventListener("resize",ne),ae()}),(a,t)=>(p(),s("div",la,[n("div",sa,[n("div",na,[n("div",oa,[t[7]||(t[7]=n("h5",{class:"mb-0"},"ðŸŒŠ Audio Waveform & Controls",-1)),n("div",ra,[void 0!==e.isTimingMode?(p(),s("div",da,[n("span",{class:o(["badge",e.isTimingMode?"bg-warning":"bg-secondary"])},r(e.isTimingMode?"Timing Mode":"Playback Mode"),3)])):u("",!0),S.value?(p(),s("div",ca,[...t[6]||(t[6]=[n("div",{class:"spinner-border spinner-border-sm",role:"status"},[n("span",{class:"visually-hidden"},"Loading...")],-1)])])):u("",!0)])]),n("div",ua,[n("div",ma,[n("button",{class:"btn btn-outline-secondary btn-sm",onClick:t[0]||(t[0]=e=>g("skip-backward")),title:"Skip backward 10s"},[...t[8]||(t[8]=[n("i",{class:"bi bi-skip-backward"},null,-1)])]),n("button",{class:"btn btn-primary btn-sm",onClick:t[1]||(t[1]=e=>g("play-pause")),disabled:!e.audioFile?.file},[n("i",{class:o(e.playbackState.isPlaying?"bi bi-pause-fill":"bi bi-play-fill")},null,2)],8,va),n("button",{class:"btn btn-outline-secondary btn-sm",onClick:t[2]||(t[2]=e=>g("skip-forward")),title:"Skip forward 10s"},[...t[9]||(t[9]=[n("i",{class:"bi bi-skip-forward"},null,-1)])])]),n("div",pa,[n("div",ba,[n("button",{class:o(["btn btn-sm","window"===z.value?"btn-primary":"btn-outline-primary"]),onClick:t[3]||(t[3]=e=>Z("window")),title:"Sliding window view"},[...t[10]||(t[10]=[n("i",{class:"bi bi-window"},null,-1),m(" Window ",-1)])],2),n("button",{class:o(["btn btn-sm","full"===z.value?"btn-primary":"btn-outline-primary"]),onClick:t[4]||(t[4]=e=>Z("full")),title:"Full song view"},[...t[11]||(t[11]=[n("i",{class:"bi bi-arrows-fullscreen"},null,-1),m(" Full ",-1)])],2)]),"full"===z.value?(p(),s("div",ga,[n("button",{class:"btn btn-sm btn-outline-secondary",onClick:Q,disabled:C.value<=1,title:"Zoom out"},[...t[12]||(t[12]=[n("i",{class:"bi bi-zoom-out"},null,-1)])],8,fa),n("span",ya,r(Math.round(100*C.value))+"%",1),n("button",{class:"btn btn-sm btn-outline-secondary",onClick:X,disabled:C.value>=5,title:"Zoom in"},[...t[13]||(t[13]=[n("i",{class:"bi bi-zoom-in"},null,-1)])],8,ha)])):u("",!0),"window"===z.value?(p(),s("div",wa,[b(n("select",{class:"form-select form-select-sm","onUpdate:modelValue":t[5]||(t[5]=e=>I.value=e),onChange:Y},[...t[14]||(t[14]=[n("option",{value:5e3},"5s",-1),n("option",{value:1e4},"10s",-1),n("option",{value:15e3},"15s",-1),n("option",{value:25e3},"25s",-1)])],544),[[x,I.value]]),n("button",{class:o(["btn btn-sm",W.value?"btn-success":"btn-outline-success"]),onClick:ee,title:"Auto-scroll with playback"},[...t[15]||(t[15]=[n("i",{class:"bi bi-skip-end"},null,-1)])],2)])):u("",!0)])]),e.playbackState?(p(),s("div",ka,[n("div",{class:"progress",style:{height:"6px",cursor:"pointer"},onClick:ie},[n("div",{class:"progress-bar",style:w({width:U.value+"%"}),role:"progressbar"},null,4)]),n("div",xa,[n("small",Ta,r(se(e.currentTime)),1),n("small",Sa,r(se(e.audioFile?.duration||0)),1)])])):u("",!0)]),n("div",Ma,[n("div",{class:"waveform-container",ref_key:"waveformContainer",ref:f},[S.value?(p(),s("div",Ca,[...t[16]||(t[16]=[n("div",{class:"spinner-border text-primary me-2",role:"status"},null,-1),n("span",null,"Analyzing audio...",-1)])])):e.audioFile?.file?(p(),s("div",Fa,[T(a.$slots,"above-waveform",{},void 0,!0),n("div",{class:"waveform-canvas-container",onMousedown:O,onMousemove:G,onMouseup:J},[n("canvas",{ref_key:"waveformCanvas",ref:y,class:"waveform-canvas",width:A.value,height:F.value,onClick:H},null,8,$a),(p(!0),s(d,null,c(R.value,(a,i)=>(p(),s("div",{key:a.id,class:o(["lyric-marker",{active:i===e.currentLineIndex,selected:E.value.includes(i)}]),style:w({left:a.position+"px"}),onClick:e=>((e,a)=>{if(a.stopPropagation(),a.ctrlKey||a.metaKey){const a=E.value.indexOf(e);a>=0?E.value.splice(a,1):E.value.push(e)}else E.value=[e]})(i,e),onMousedown:e=>((e,a)=>{a.stopPropagation(),D.value=!0,L.value=e;const t=()=>{D.value},i=()=>{if(D.value){const e=y.value.getBoundingClientRect(),t=a.clientX-e.left,i=K(t);g("lyrics-position",L.value,Math.max(0,i))}D.value=!1,L.value=-1,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",i)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",i)})(i,e),title:`Line ${a.lineNumber}: ${a.text}`},[t[18]||(t[18]=n("div",{class:"marker-line"},null,-1)),n("div",Da,r(a.lineNumber),1)],46,Pa))),128)),null!==$.value&&null!==P.value?(p(),s("div",{key:0,class:"selection-area",style:w(q.value)},null,4)):u("",!0),n("div",La,[(p(!0),s(d,null,c(_.value,e=>(p(),s("div",{key:e.time,class:"time-mark",style:w({left:e.position+"px"})},[t[19]||(t[19]=n("div",{class:"time-mark-line"},null,-1)),n("div",Ea,r(e.label),1)],4))),128))])],32)])):(p(),s("div",Aa,[...t[17]||(t[17]=[n("div",{class:"text-center text-muted"},[n("i",{class:"bi bi-music-note-beamed display-4"}),n("p",{class:"mt-2"},"No audio file loaded")],-1)])]))],512)]),n("div",za,[n("div",Ia,[n("div",ja,[n("small",Wa,[e.audioFile?.duration?(p(),s("span",Ra,"Duration: "+r(se(e.audioFile.duration)),1)):u("",!0),B.value?(p(),s("span",Na," â€¢ Selection: "+r(se(B.value)),1)):u("",!0)])]),n("div",Ua,[n("small",Ba,r(e.lyrics.length)+" lyrics â€¢ "+r(N.value)+" positioned ",1)]),n("div",qa,[n("small",_a,["window"===z.value?(p(),s("span",Va,"Window: "+r(se(I.value)),1)):u("",!0),"full"===z.value?(p(),s("span",Ka,"Zoom: "+r(Math.round(100*C.value))+"%",1)):u("",!0)])])])])])]))}}),Oa=y(Ha,[["__scopeId","data-v-d3d7a42c"]]),Ga={class:"mb-4"},Ja={class:"d-grid gap-1"},Xa={class:"timing-status small text-muted mt-1"},Qa={class:"mb-4"},Za={class:"d-grid gap-1"},Ya=["disabled"],et=["disabled"],at=["disabled"],tt=["disabled"],it={key:0,class:"mt-2 p-2 bg-light rounded small"},lt={class:"row"},st={class:"col-6"},nt={class:"col-6"},ot={class:"mb-4"},rt={class:"d-grid gap-1"},dt=["disabled"],ct=["disabled"],ut=["disabled"],mt={class:"mb-2"},vt={key:0,class:"mb-2"},pt={class:"mb-0 ps-3"},bt={key:0,class:"small text-muted"},gt={key:1,class:"mb-2"},ft={class:"mb-0 ps-3"},yt={key:0,class:"small text-muted"},ht={key:2,class:"mb-2"},wt={class:"small"},kt={class:"small text-muted"},xt=t({__name:"TimingControlsPanel",props:{isTimingMode:{type:Boolean},timedWords:{},totalWords:{},songAnalysis:{},timingAnalysis:{}},emits:["toggle-timing-mode","apply-musical-timing","reset-syllable-timing","clear-timing","analyze-timing","fix-overlaps"],setup(e){const a=e,t=i(!1),v=i(!1),b=l(()=>(a.timedWords||0)>0);return(a,i)=>(p(),s(d,null,[n("div",Ga,[i[9]||(i[9]=n("h6",null,[n("i",{class:"bi bi-stopwatch"}),m(" Timing Mode")],-1)),n("div",Ja,[n("button",{class:o(["btn btn-sm",e.isTimingMode?"btn-warning":"btn-outline-primary"]),onClick:i[0]||(i[0]=e=>a.$emit("toggle-timing-mode"))},[i[8]||(i[8]=n("i",{class:"bi bi-crosshair"},null,-1)),m(" "+r(e.isTimingMode?"Exit Timing":"Start Timing"),1)],2),n("div",Xa,[e.isTimingMode?(p(),s(d,{key:0},[m(" Press Space during playback to assign word timings ")],64)):(p(),s(d,{key:1},[m(" Word boxes can be edited manually ")],64))])])]),n("div",Qa,[i[20]||(i[20]=n("h6",null,[n("i",{class:"bi bi-music-note"}),m(" Musical Timing")],-1)),n("div",Za,[n("button",{class:"btn btn-sm btn-outline-success",onClick:i[1]||(i[1]=e=>a.$emit("apply-musical-timing")),disabled:!b.value},[...i[10]||(i[10]=[n("i",{class:"bi bi-magic"},null,-1),m(" Apply Musical Intelligence ",-1)])],8,Ya),n("button",{class:"btn btn-sm btn-outline-secondary",onClick:i[2]||(i[2]=e=>a.$emit("reset-syllable-timing")),disabled:!b.value},[...i[11]||(i[11]=[n("i",{class:"bi bi-arrow-clockwise"},null,-1),m(" Reset Syllable Timing ",-1)])],8,et),n("button",{class:"btn btn-sm btn-outline-danger",onClick:i[3]||(i[3]=e=>a.$emit("clear-timing")),disabled:!b.value},[...i[12]||(i[12]=[n("i",{class:"bi bi-trash"},null,-1),m(" Clear from Current Line ",-1)])],8,at),n("button",{class:"btn btn-sm btn-outline-info",onClick:i[4]||(i[4]=e=>t.value=!t.value),disabled:!b.value},[i[13]||(i[13]=n("i",{class:"bi bi-graph-up"},null,-1)),m(" "+r(t.value?"Hide":"Show")+" Analysis ",1)],8,tt)]),t.value&&e.songAnalysis?(p(),s("div",it,[n("div",lt,[n("div",st,[i[14]||(i[14]=n("strong",null,"BPM:",-1)),m(" "+r(e.songAnalysis.estimatedBPM.toFixed(0)),1),i[15]||(i[15]=n("br",null,null,-1)),i[16]||(i[16]=n("strong",null,"Words:",-1)),m(" "+r(e.songAnalysis.totalWords),1)]),n("div",nt,[i[17]||(i[17]=n("strong",null,"Rests:",-1)),m(" "+r(e.songAnalysis.detectedRests),1),i[18]||(i[18]=n("br",null,null,-1)),i[19]||(i[19]=n("strong",null,"Quality:",-1)),m(" "+r(e.songAnalysis.timingQuality),1)])])])):u("",!0),i[21]||(i[21]=n("div",{class:"timing-status small text-muted mt-1"}," Musical timing analyzes your word timings to distribute syllables using musical patterns (8th notes, quarter notes, etc.) and respects natural pauses. ",-1))]),n("div",ot,[i[29]||(i[29]=n("h6",null,[n("i",{class:"bi bi-search"}),m(" Timing Diagnostics")],-1)),n("div",rt,[n("button",{class:"btn btn-sm btn-outline-info",onClick:i[5]||(i[5]=e=>a.$emit("analyze-timing")),disabled:!b.value},[...i[22]||(i[22]=[n("i",{class:"bi bi-bug"},null,-1),m(" Check for Overlaps ",-1)])],8,dt),n("button",{class:"btn btn-sm btn-outline-warning",onClick:i[6]||(i[6]=e=>a.$emit("fix-overlaps")),disabled:!b.value},[...i[23]||(i[23]=[n("i",{class:"bi bi-wrench"},null,-1),m(" Fix Overlaps ",-1)])],8,ct),n("button",{class:"btn btn-sm btn-outline-secondary",onClick:i[7]||(i[7]=e=>v.value=!v.value),disabled:!b.value},[i[24]||(i[24]=n("i",{class:"bi bi-info-circle"},null,-1)),m(" "+r(v.value?"Hide":"Show")+" Details ",1)],8,ut)]),v.value&&e.timingAnalysis?(p(),s("div",{key:0,class:o(["mt-2 p-2 rounded small",e.timingAnalysis.hasIssues?"bg-warning bg-opacity-10 border border-warning":"bg-success bg-opacity-10 border border-success"])},[n("div",mt,[i[25]||(i[25]=n("strong",null,"Status:",-1)),m(" "+r(e.timingAnalysis.summary),1)]),e.timingAnalysis.sequenceViolations&&e.timingAnalysis.sequenceViolations.length>0?(p(),s("div",vt,[i[26]||(i[26]=n("strong",{class:"text-danger"},"ðŸš¨ Sequence Violations:",-1)),n("ul",pt,[(p(!0),s(d,null,c(e.timingAnalysis.sequenceViolations.slice(0,3),e=>(p(),s("li",{key:`${e.word1}-${e.word2}`,class:"small text-danger"},r(e.issue),1))),128)),e.timingAnalysis.sequenceViolations.length>3?(p(),s("li",bt," ...and "+r(e.timingAnalysis.sequenceViolations.length-3)+" more ",1)):u("",!0)])])):u("",!0),e.timingAnalysis.overlaps.length>0?(p(),s("div",gt,[i[27]||(i[27]=n("strong",{class:"text-warning"},"Overlaps Found:",-1)),n("ul",ft,[(p(!0),s(d,null,c(e.timingAnalysis.overlaps.slice(0,5),e=>(p(),s("li",{key:`${e.word1.lineIndex}-${e.word1.wordIndex}`,class:"small"},' "'+r(e.word1.word)+'" â†’ "'+r(e.word2.word)+'" ('+r(e.overlapDuration)+"ms overlap) ",1))),128)),e.timingAnalysis.overlaps.length>5?(p(),s("li",yt," ...and "+r(e.timingAnalysis.overlaps.length-5)+" more ",1)):u("",!0)])])):u("",!0),e.timingAnalysis.smallGaps.length>0?(p(),s("div",ht,[i[28]||(i[28]=n("strong",{class:"text-info"},"Small Gaps:",-1)),n("span",wt,r(e.timingAnalysis.smallGaps.length)+" gaps < 50ms",1)])):u("",!0),n("div",kt,r(e.timingAnalysis.timedWords)+" of "+r(e.timingAnalysis.totalWords)+" words have timing data ",1)],2)):u("",!0),i[30]||(i[30]=n("div",{class:"timing-status small text-muted mt-1"}," Overlapping word timings can cause editing issues. Use diagnostics to detect and fix timing problems. ",-1))])],64))}}),Tt={class:"mb-4"},St={class:"small"},Mt={class:"d-flex justify-content-between"},Ct={class:"d-flex justify-content-between"},At={class:"d-flex justify-content-between"},Ft=t({__name:"ProgressStats",props:{timingStats:{}},setup:e=>(a,t)=>(p(),s("div",Tt,[t[3]||(t[3]=n("h6",null,"Progress",-1)),n("div",St,[n("div",Mt,[t[0]||(t[0]=n("span",null,"Lines:",-1)),n("span",null,r(e.timingStats.timedLines)+"/"+r(e.timingStats.totalLines),1)]),n("div",Ct,[t[1]||(t[1]=n("span",null,"Words:",-1)),n("span",null,r(e.timingStats.timedWords)+"/"+r(e.timingStats.totalWords),1)]),n("div",At,[t[2]||(t[2]=n("span",null,"Syllables:",-1)),n("span",null,r(e.timingStats.timedSyllables)+"/"+r(e.timingStats.totalSyllables),1)])])]))}),$t=y({},[["render",function(e,a){return p(),s("div",null,[...a[0]||(a[0]=[S('<h6 data-v-f8f0e233><i class="bi bi-question-circle" data-v-f8f0e233></i> Hotkeys</h6><div class="small" data-v-f8f0e233><div class="hotkey-list mb-2" data-v-f8f0e233><div class="hotkey-item" data-v-f8f0e233><kbd data-v-f8f0e233>Space</kbd><span data-v-f8f0e233>Play/Timing</span></div><div class="hotkey-item" data-v-f8f0e233><kbd data-v-f8f0e233>Enter</kbd><span data-v-f8f0e233>Play/Pause</span></div><div class="hotkey-item" data-v-f8f0e233><kbd data-v-f8f0e233>0</kbd><kbd data-v-f8f0e233>.</kbd><span data-v-f8f0e233>Assign timing</span></div><div class="hotkey-item" data-v-f8f0e233><kbd data-v-f8f0e233>+</kbd><kbd data-v-f8f0e233>-</kbd><span data-v-f8f0e233>Skip short</span></div><div class="hotkey-item" data-v-f8f0e233><kbd data-v-f8f0e233>Ctrl</kbd><kbd data-v-f8f0e233>â†</kbd><kbd data-v-f8f0e233>â†’</kbd><span data-v-f8f0e233>Skip 5s</span></div><div class="hotkey-item" data-v-f8f0e233><kbd data-v-f8f0e233>Alt</kbd><kbd data-v-f8f0e233>T</kbd><span data-v-f8f0e233>Toggle mode</span></div><div class="hotkey-item" data-v-f8f0e233><kbd data-v-f8f0e233>Ctrl</kbd><kbd data-v-f8f0e233>F</kbd><span data-v-f8f0e233>Fast refresh (smoother)</span></div><div class="hotkey-item" data-v-f8f0e233><kbd data-v-f8f0e233>Home</kbd><kbd data-v-f8f0e233>End</kbd><span data-v-f8f0e233>Start/End</span></div><div class="hotkey-item" data-v-f8f0e233><kbd data-v-f8f0e233>Esc</kbd><span data-v-f8f0e233>Exit &quot;Add Timing&quot; mode</span></div></div><div class="timing-steps" data-v-f8f0e233><strong data-v-f8f0e233>Workflow:</strong><ol class="small-steps" data-v-f8f0e233><li data-v-f8f0e233>Start timing mode</li><li data-v-f8f0e233>Press Space to play, then Space during playback to assign timings</li><li data-v-f8f0e233>Edit word boxes manually</li><li data-v-f8f0e233>Adjust syllable timings</li></ol></div></div>',2)])])}],["__scopeId","data-v-f8f0e233"]]),Pt={class:"mb-3"},Dt={class:"small"},Lt={class:"d-flex justify-content-between"},Et={class:"text-primary font-monospace"},zt={class:"d-flex justify-content-between"},It={class:"text-success font-monospace"},jt=t({__name:"ViewportIndicator",props:{viewportWidth:{},currentBreakpoint:{}},setup:e=>(a,t)=>(p(),s("div",Pt,[t[2]||(t[2]=n("h6",null,[n("i",{class:"bi bi-display"}),m(" Viewport")],-1)),n("div",Dt,[n("div",Lt,[t[0]||(t[0]=n("span",null,"Width:",-1)),n("span",Et,r(e.viewportWidth)+"px",1)]),n("div",zt,[t[1]||(t[1]=n("span",null,"Breakpoint:",-1)),n("span",It,r(e.currentBreakpoint),1)])])]))}),Wt={key:0,class:"full-width-layout"},Rt={class:"flexible-layout"},Nt={class:"sidebar-column"},Ut={class:"card h-100"},Bt={class:"card-header py-2"},qt={class:"d-flex align-items-center justify-content-between"},_t={class:"mb-0"},Vt={class:"text-muted"},Kt={class:"card-body"},Ht={class:"main-content-column"},Ot={class:"row mb-3"},Gt={class:"col-6"},Jt={class:"col-6"},Xt={class:"row mb-3"},Qt={class:"col-12"},Zt={class:"row mb-3"},Yt={class:"col-12"},ei={class:"text-muted"},ai={key:0},ti={key:1,class:"full-width-layout"},ii={key:2,class:"full-width-layout"},li={class:"d-flex justify-content-center"},si={class:"card",style:{"max-width":"500px"}},ni={class:"card-body p-5 text-center"};e("default",y(t({__name:"TimingView",setup(e){const a=$(),t=P(),d=i(),c=i(null),b=i(!0),g=i(!1),f=i(0),y=i(0),h=i(!1),w=i(0),x=i(null),T=i(null),{analyzeTimingOverlaps:I,fixTimingOverlaps:W}={analyzeTimingOverlaps:function(e){const a=[],t=[],i=[];let l=0,s=0;const n=[];if(e.forEach((e,a)=>{e.words.forEach((e,t)=>{l++,void 0!==e.startTime&&void 0!==e.endTime&&(s++,n.push({...e,lineIndex:a,wordIndex:t}))})}),0===s)return{overlaps:[],totalWords:l,timedWords:s,smallGaps:[],sequenceViolations:[],summary:"No timed words found.",hasIssues:!1};e.forEach(e=>{const a=e.words.filter(e=>void 0!==e.startTime&&void 0!==e.endTime);for(let t=0;t<a.length-1;t++){const e=a[t],l=a[t+1];e.startTime>l.startTime&&i.push({word1:e.word,word2:l.word,issue:`"${e.word}" starts at ${e.startTime}ms but comes before "${l.word}" at ${l.startTime}ms`})}}),n.sort((e,a)=>(e.startTime||0)-(a.startTime||0));for(let c=0;c<n.length-1;c++){const e=n[c],t=n[c+1];if(e.endTime>t.startTime){const i=t.startTime,l=Math.min(e.endTime,t.endTime),s=l-i;a.push({word1:e,word2:t,overlapStart:i,overlapEnd:l,overlapDuration:s})}}for(let c=0;c<n.length-1;c++){const e=n[c],a=n[c+1],i=a.startTime-e.endTime;i>=0&&i<50&&t.push({word1:e.word,word2:a.word,gap:i})}const o=a.length>0||t.length>3||i.length>0,r=a.length+t.length+i.length;let d="";return d=i.length>0?`ðŸš¨ Critical: ${i.length} words out of sequence! This breaks timing order.`:0===a.length&&t.length<=3?`âœ… Clean timing: ${s} words, good spacing`:`âš ï¸ Found ${r} spacing issues (${a.length} overlaps, ${t.length} tight gaps) - may affect editing`,{overlaps:a,totalWords:l,timedWords:s,smallGaps:t,sequenceViolations:i,summary:d,hasIssues:o}},fixTimingOverlaps:function(e){console.log("ðŸ”§ Starting timing overlap fix...");const a=[];let t=0;const i=[];e.forEach((e,a)=>{e.words.forEach((e,t)=>{void 0!==e.startTime&&void 0!==e.endTime&&i.push({word:e,lineIndex:a,wordIndex:t})})}),console.log(`ðŸ” Found ${i.length} timed words to check`),i.sort((e,a)=>(e.word.startTime||0)-(a.word.startTime||0));for(let l=0;l<i.length-1;l++){const e=i[l],s=i[l+1],n=e.word,o=s.word,r=o.startTime-n.endTime;if(r<50){const e=n.endTime,i=o.startTime-50;r<0?console.log(`ðŸ”§ Fixing overlap: "${n.word}" (${e}ms) â†’ "${o.word}" (${o.startTime}ms)`):console.log(`ðŸ”§ Fixing tight spacing: "${n.word}" â†’ "${o.word}" (${r}ms gap â†’ 50ms gap)`),console.log(`   Adjusting "${n.word}" end time: ${e}ms â†’ ${i}ms`),n.endTime=i,n.duration=n.endTime-n.startTime;const l=r<0?"overlap":"tight spacing";if(a.push(`Fixed ${l} "${n.word}": ${e}ms â†’ ${n.endTime}ms`),t++,n.syllables&&n.syllables.length>0){const e=n.duration;let a=n.startTime;n.syllables.forEach(t=>{const i=e/n.syllables.length;t.startTime=a,t.endTime=a+i,t.duration=i,a=t.endTime}),console.log(`   Updated ${n.syllables.length} syllables for "${n.word}"`)}}}return console.log(`âœ… Fixed ${t} overlaps`),{fixCount:t,details:a}}},H=i(null),O=i(0),J=i(60),X=i("window"),Q=i("undefined"!=typeof window?window.innerWidth:1024),Z=i("undefined"!=typeof window?window.innerHeight:768);let Y=null;const ee=i({isPlaying:!1,currentTime:0,duration:0,volume:1,playbackRate:1,isLoaded:!1}),ae=i(!1),te=l(()=>c.value?N(c.value.lyrics):{totalLines:0,timedLines:0,totalWords:0,timedWords:0,totalSyllables:0,timedSyllables:0,completionPercent:0}),ie=l(()=>{const e=Q.value;return e>=1400?"xxl":e>=1200?"xl":e>=992?"lg":e>=768?"md":e>=576?"sm":"xs"}),le=l(()=>{if(!c.value?.lyrics)return console.log("ðŸ” timingEditorWords: No project or lyrics"),[];const e=[];let a=0;return c.value.lyrics.forEach(t=>{de(t)||t.words&&Array.isArray(t.words)&&(t.words.forEach((t,i)=>{e.push({id:`lyrics-${a}-word-${i}`,text:t.word,startTime:(t.startTime||0)/1e3,endTime:(t.endTime||t.startTime||0)/1e3,syllables:t.syllables?.map(e=>({text:e.syllable,startTime:(e.startTime||0)/1e3,endTime:(e.endTime||e.startTime||0)/1e3}))})}),a++)}),e}),se=l(()=>ee.value.duration||60),ne=()=>{g.value=!1},oe=()=>{window.history.length>1?t.back():t.push("/compose")},re=(e,a,t)=>{O.value=e,J.value=a,X.value=t},de=e=>void 0!==e.type&&"lyrics"!==e.type,ce=e=>{if(!c.value)return e;for(let a=e;a<c.value.lyrics.length;a++){const e=c.value.lyrics[a];if(!de(e)&&e.words&&e.words.length>0)return a}return e},ue=e=>{if(!c.value||e>=c.value.lyrics.length)return void(f.value=e);const a=c.value.lyrics[e];if(de(a)){let a=ce(e+1);return a===e+1&&a>=c.value.lyrics.length&&(a=(e=>{if(!c.value)return e;for(let a=e;a>=0;a--){const e=c.value.lyrics[a];if(!de(e)&&e.words&&e.words.length>0)return a}return e})(e-1)),void(f.value=a)}if(void 0!==a.startTime&&a.words&&a.words.length>0){f.value=e,y.value=0;const t=a.words[0],i=t.endTime&&t.startTime?t.endTime-t.startTime:500,l=Math.max(0,a.startTime-i);console.log(`ðŸ“ Smart line selection: Line ${e+1} with timing at ${a.startTime}ms, seeking to lead-in at ${l}ms`),K.seek(l)}else{let a=e-1,t=null;for(;a>=0;){const e=c.value.lyrics[a];if(!de(e)&&void 0!==e.startTime){t=e;break}a--}if(t&&void 0!==t.startTime){console.log(`ðŸ“ Smart line selection: Line ${e+1} without timing, seeking to previous timed line at ${t.startTime}ms`),K.seek(t.startTime);const i=a+1;i<c.value.lyrics.length&&!de(c.value.lyrics[i])?(f.value=i,y.value=0,console.log(`ðŸ“ Auto-selected next line ${i+1} for timing continuation`)):(f.value=e,y.value=0)}else f.value=e,y.value=0,console.log(`ðŸ“ Line ${e+1} selected without timing, no previous timed line found`)}},me=e=>{c.value&&(c.value.lyrics=e)},ve=async()=>{try{ee.value.isPlaying?(K.pause(),console.log("Audio paused")):(console.log("Attempting to play audio..."),await K.play(),console.log("Audio play initiated"))}catch(e){console.error("Failed to toggle play/pause:",e),alert("Failed to play audio. The audio context may need to be restarted. Try clicking the play button again.")}},pe=e=>{K.seek(e)},be=()=>{const e=Math.max(0,ee.value.currentTime-1e4);K.seek(e)},ge=()=>{const e=c.value?.audioFile?.duration||0;if(e>0){const a=Math.min(e-100,ee.value.currentTime+1e4);K.seek(a)}},fe=()=>{h.value=!h.value},ye=async()=>{try{await K.play(),K.pause(),console.log("Audio context verified as ready")}catch(e){console.warn("Audio context may need user interaction:",e)}},he=()=>{if(!c.value)return;const e=f.value,a=c.value.lyrics.length-e;confirm(1===a?"Clear timing for the current line?":`Clear timing for the current line and ${a-1} lines after it?\n\nThis prevents timing inconsistencies by clearing all subsequent timing.`)&&(c.value.lyrics=j(c.value.lyrics,e),console.log(`ðŸ—‘ï¸ Cleared timing from line ${e} onwards (${a} lines affected)`))},we=()=>{if(console.log("ðŸŽ¯ assignTiming called",{hasProject:!!c.value,isTimingMode:h.value,isPlaying:ee.value.isPlaying,currentLine:f.value,currentWord:y.value,currentTime:ee.value.currentTime}),!c.value||!h.value)return void console.log("âŒ assignTiming aborted: missing project or not in timing mode");if(!ee.value.isPlaying)return void console.log("âŒ assignTiming aborted: audio not playing");const e=f.value,a=y.value,t=ee.value.currentTime;if(e>=c.value.lyrics.length)return void console.log("âŒ assignTiming aborted: invalid line index");const i=c.value.lyrics[e];if(!i||!i.words||a>=i.words.length)return void console.log("âŒ assignTiming aborted: invalid word index");const l=((e,a)=>{if(!c.value)return 500;const t=c.value.lyrics,i=t[e];if(!i)return 500;let l;if(a<i.words.length-1)l=i.words[a+1].startTime;else{let a=e+1;for(;a<t.length;){const e=t[a];if(!de(e)&&e.words.length>0){l=e.words[0].startTime;break}a++}}if(l){const e=l/1e3-ee.value.currentTime;if(E.isPhraseBreak(e)){const a=e*z.autoTiming.phraseBreakSpacing*1e3;return Math.max(z.word.minDuration,Math.min(z.autoTiming.maxPhraseBreakDuration,a))}{const a=e*z.autoTiming.normalWordSpacing*1e3;return Math.max(z.word.minDuration,Math.min(z.autoTiming.maxNormalDuration,a))}}const s=i.words[a];if(s){const e=s.word.length;return Math.max(200,80*e)}return 500})(e,a);c.value.lyrics=B(c.value.lyrics,e,a,t,l),console.log("âœ… Smart timing assigned:",{word:c.value.lyrics[e].words[a].word,startTime:t,duration:l,calculation:l>400?"phrase-break":"normal-spacing"}),ke()},ke=()=>{if(!c.value)return;const e=c.value.lyrics[f.value];if(!e)return;const a=f.value,t=y.value;if(y.value<e.words.length-1)y.value++;else{let e=f.value+1;for(;e<c.value.lyrics.length;){const a=c.value.lyrics[e];if(a.words&&a.words.length>0){f.value=e,y.value=0;break}e++}}const i=f.value!==a||y.value!==t;if(i&&c.value)c.value.lyrics=U(c.value.lyrics,a,t);else if(!i&&c.value){const e=c.value.lyrics[a]?.words?.[t];e&&void 0!==e.startTime&&e.syllables&&e.syllables.length>0&&(c.value.lyrics=U(c.value.lyrics,a,t),console.log("ðŸ Finalized syllables for final word:",e.word))}},xe=(e,a)=>{if(!c.value)return;const t=c.value.lyrics[e];t&&(t.startTime=a)},Te=()=>{c.value&&(c.value.updatedAt=new Date,Ce(),console.log("Project saved:",c.value.name))},Se=async e=>{if(!e.audioFile)return console.error("No audio file in project"),!1;console.log("ðŸ”„ Loading project audio:",{projectName:e.name,audioFileName:e.audioFile.name,hasFile:!!e.audioFile.file,hasStoredData:!!e.audioFile.storedData,storageType:e.audioFile.storedData?.storageType,duration:e.audioFile.duration});try{let t=e.audioFile;if(!t.file&&t.storedData){console.log("Retrieving stored audio file...");const a=await q.retrieveAudioFile(t.storedData);if(!a)return console.error("Failed to retrieve audio file"),!1;t={...t,...a},e.audioFile=t,console.log("âœ… Audio file retrieved successfully")}let i=!1,l=3;for(;!i&&l>0;)try{if(console.log(`Attempting to load audio (${4-l}/3)...`),i=await K.loadAudioFile(t),i){const a=K.getPlaybackState();if(ee.value={...a},e.audioFile.duration&&e.audioFile.duration===a.duration||(console.log("ðŸ’¾ Storing detected audio duration:",a.duration/1e3,"seconds"),e.audioFile.duration=a.duration,e.updatedAt=new Date,Ce()),!x.value){const e=await K.generateWaveformData(1e3);e&&(x.value={peaks:e,sampleRate:44100,duration:a.duration,channels:1})}console.log("âœ… Audio loaded successfully");break}l--,l>0&&(console.warn(`Audio loading failed, retrying... (${l} attempts left)`),await new Promise(e=>setTimeout(e,1e3)))}catch(a){console.error("Audio loading attempt failed:",a),l--,l>0&&await new Promise(e=>setTimeout(e,1e3))}return!!i||(console.error("Failed to load audio after multiple attempts"),!1)}catch(t){return console.error("Error loading project audio:",t),!1}},Ce=()=>{if(c.value)try{const e=localStorage.getItem("karaokeProjects"),a=e?JSON.parse(e):[],t=a.findIndex(e=>e.id===c.value.id);if(-1!==t){const e={...c.value,audioFile:{...c.value.audioFile,file:null,url:void 0}};a[t]=e,localStorage.setItem("karaokeProjects",JSON.stringify(a)),console.log("ðŸ’¾ Project saved to storage")}}catch(e){console.error("Error saving project:",e)}},Ae=()=>{const e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))switch(e.code){case"Space":e.preventDefault(),h.value&&ee.value.isPlaying?we():ve();break;case"NumpadEnter":case"Enter":e.ctrlKey||e.metaKey||(e.preventDefault(),ve());break;case"Numpad0":case"NumpadDecimal":e.preventDefault(),h.value&&we();break;case"NumpadAdd":e.preventDefault(),(()=>{const e=c.value?.audioFile?.duration||0;if(e>0){const a=Math.min(e-100,ee.value.currentTime+1e3);K.seek(a)}})();break;case"NumpadSubtract":e.preventDefault(),(()=>{const e=Math.max(0,ee.value.currentTime-1e3);K.seek(e)})();break;case"KeyT":case"Insert":e.preventDefault(),fe();break;case"KeyP":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),ve());break;case"KeyS":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),Te());break;case"KeyL":case"ArrowLeft":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),be());break;case"KeyR":case"ArrowRight":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),ge());break;case"Home":e.preventDefault(),K.seek(0),f.value=ce(0),y.value=0;break;case"End":e.preventDefault(),(()=>{const e=c.value?.audioFile?.duration||0;if(e>0){const a=Math.max(0,e-10);K.seek(a)}})();break;case"KeyF":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),K.toggleFastMode(),ae.value=K.getFastMode(),console.log("ðŸ”„ Toggled fast refresh mode"));break;case"Escape":e.preventDefault(),g.value?ne():h.value&&((()=>{if(!c.value)return;const e=f.value,a=y.value;if(e>=0&&e<c.value.lyrics.length){const t=c.value.lyrics[e];if(t&&t.words&&a>=0&&a<t.words.length){const i=t.words[a];void 0!==i.startTime&&i.syllables&&i.syllables.length>0&&i.syllables.some(e=>void 0===e.startTime||void 0===e.endTime)&&(c.value.lyrics=U(c.value.lyrics,e,a),console.log("ðŸ”„ Finalized syllables for current word:",i.word))}}})(),h.value=!1)}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},Fe=()=>{if(c.value?.lyrics){console.log("ðŸŽµ Applying musical timing to song...");try{const e=G(c.value.lyrics);T.value=e,console.log("âœ… Musical timing applied successfully",e)}catch(e){console.error("âŒ Error applying musical timing:",e)}}else console.log("âŒ Musical timing: No project or lyrics available")},$e=()=>{if(c.value?.lyrics){console.log("ðŸ”„ Resetting all syllable timing...");try{!function(e){let a=0;for(const t of e)for(const e of t.words)e.syllables.forEach(e=>{void 0!==e.startTime&&a++,e.startTime=void 0,e.endTime=void 0,e.duration=void 0});console.log(`ðŸ”„ Reset syllable timing for ${a} syllables`)}(c.value.lyrics),T.value=null,console.log("âœ… Syllable timing reset successfully")}catch(e){console.error("âŒ Error resetting syllable timing:",e)}}else console.log("âŒ Reset timing: No project or lyrics available")},Pe=()=>{if(c.value?.lyrics){console.log("ðŸ” Analyzing timing overlaps...");try{const e=I(c.value.lyrics);H.value=e,console.log("âœ… Timing analysis completed:",e.summary),e.overlaps.length>0&&(console.warn(`Found ${e.overlaps.length} timing overlaps:`),e.overlaps.forEach((e,a)=>{console.warn(`  ${a+1}. "${e.word1.word}" â†’ "${e.word2.word}" (${e.overlapDuration}ms overlap)`)}))}catch(e){console.error("âŒ Error analyzing timing:",e)}}else console.log("âŒ Timing analysis: No project or lyrics available")},De=async()=>{if(c.value?.lyrics){console.log("ðŸ”§ Fixing timing overlaps...");try{const e=W(c.value.lyrics);e.fixCount>0?(console.log(`âœ… Fixed ${e.fixCount} timing overlaps:`),e.details.forEach(e=>console.log(`  â€¢ ${e}`)),await Te(),w.value++,await v(),Pe(),console.log("ðŸ”„ Visual refresh triggered after timing fix")):console.log("âœ… No overlaps to fix!")}catch(e){console.error("âŒ Error fixing timing overlaps:",e)}}else console.log("âŒ Fix overlaps: No project or lyrics available")},Le=e=>{if(!c.value?.lyrics)return void console.error("âŒ No project lyrics to update");const a=c.value.lyrics.filter(e=>!de(e));e.forEach(e=>{const t=e.id.match(/lyrics-(\d+)-word-(\d+)/);if(t){const l=parseInt(t[1]),s=parseInt(t[2]);if(l<a.length){const t=a[l];if(s<t.words.length){const a=t.words[s],n=a.startTime||0,o=a.endTime||0,r=Math.round(1e3*e.startTime),d=Math.round(1e3*e.endTime);let c=!1;if(e.syllables&&a.syllables&&e.syllables.length===a.syllables.length&&(c=e.syllables.some((e,t)=>{const i=a.syllables[t],l=Math.round(1e3*e.startTime),s=Math.round(1e3*e.endTime);return Math.abs(l-(i.startTime||0))>1||Math.abs(s-(i.endTime||0))>1})),c&&e.syllables)a.syllables=e.syllables.map(e=>({syllable:e.text,startTime:Math.round(1e3*e.startTime),endTime:Math.round(1e3*e.endTime)})),a.startTime=r,a.endTime=d,a.duration=d-r;else if(a.syllables&&a.syllables.length>0)try{const e=a.syllables.map(e=>({text:e.syllable||"",startTime:e.startTime||0,endTime:e.endTime||0})),t=V.fromAbsoluteSyllables(`word-${l}-${s}`,a.word,n,o,e);let i;const c=Math.abs(r-n)>10,u=Math.abs(d-o)>10;if(c&&!u){i=t.moveWord(r);const e=i.getWordData(),l=i.getAbsoluteSyllables();a.startTime=e.startTime,a.endTime=e.endTime,a.duration=a.endTime-a.startTime,a.syllables=l.map(e=>({syllable:e.text,startTime:e.startTime,endTime:e.endTime,duration:e.endTime-e.startTime}))}else if(u&&!c)a.endTime=d,a.duration=d-(a.startTime||0);else if(c&&u){i=t.moveWord(r);const e=i.getAbsoluteSyllables();a.startTime=r,a.endTime=d,a.duration=d-r,a.syllables=e.map(e=>({syllable:e.text,startTime:e.startTime,endTime:e.endTime,duration:e.endTime-e.startTime}))}}catch(i){console.error(`âŒ Error using RelativeSyllableTiming for "${a.word}":`,i),a.startTime=r,a.endTime=d,a.duration=a.endTime-a.startTime}else a.startTime=r,a.endTime=d,a.duration=a.endTime-a.startTime}}}})},Ee=e=>{console.log("ðŸŽ¯ Word selected:",e)};return k(async()=>{const e=a.params.projectId;e?await(async e=>{const a=localStorage.getItem("karaokeProjects");if(!a)return console.warn("No projects found in storage, redirecting to compose page"),alert("âš ï¸ No projects found. Redirecting to the compose page."),void t.push("/compose");try{const i=JSON.parse(a).find(a=>a.id===e);if(!i)return console.warn(`Project ${e} not found, redirecting to compose page`),alert("âš ï¸ Project not found. It may have been deleted. Redirecting to the compose page."),void t.push("/compose");const l={...i,createdAt:new Date(i.createdAt),updatedAt:new Date(i.updatedAt),audioFile:{...i.audioFile,file:null}};if(c.value=l,!(await Se(l)))return console.warn(`Failed to load audio for project ${e}, redirecting to compose page`),alert("âš ï¸ Could not load the audio file for this project. Please check if the file still exists or try re-importing it. Redirecting to the compose page."),void t.push("/compose");f.value=ce(0),y.value=0,b.value=!1}catch(i){console.error("Error loading project:",i),alert(`âš ï¸ Error loading project: ${i}. Redirecting to the compose page.`),t.push("/compose")}})(e):b.value=!1,(()=>{let e=0;K.onTimeUpdate(a=>{if(ee.value.currentTime=a,e>5e3&&a<1e3&&(f.value=ce(0),y.value=0,console.log("ðŸ”„ Audio reset detected, resetting to first lyric line")),e=a,c.value&&ee.value.isPlaying&&!h.value){const e=R(c.value.lyrics,a),t=c.value.lyrics[e.lineIndex];t&&!de(t)&&(f.value=e.lineIndex,y.value=e.wordIndex),ee.value.currentWord={lineIndex:e.lineIndex,wordIndex:e.wordIndex},ee.value.currentSyllable={lineIndex:e.lineIndex,wordIndex:e.wordIndex,syllableIndex:e.syllableIndex}}else if(c.value&&ee.value.isPlaying&&h.value){const e=R(c.value.lyrics,a);ee.value.currentWord={lineIndex:e.lineIndex,wordIndex:e.wordIndex},ee.value.currentSyllable={lineIndex:e.lineIndex,wordIndex:e.wordIndex,syllableIndex:e.syllableIndex}}}),K.onPlaybackStateChange(e=>{ee.value={...e}})})();const i=Ae();Y=i,setTimeout(()=>{d.value&&(d.value.focus(),console.log("TimingView focused for hotkey support"))},100);const l=()=>{Q.value=window.innerWidth,Z.value=window.innerHeight};window.addEventListener("resize",l);const s=Y;Y=()=>{s&&s(),window.removeEventListener("resize",l)}}),M(()=>{K.pause(),Y&&Y()}),(e,a)=>{const t=D("router-link");return p(),s("div",{class:"timing-view",tabindex:"0",ref_key:"timingViewRef",ref:d,onClick:ye},[c.value?(p(),s("div",Wt,[n("div",Rt,[n("div",Nt,[n("div",Ut,[n("div",Bt,[n("div",qt,[n("div",null,[n("h6",_t,r(c.value?.name),1),n("small",Vt,r(c.value?.artist),1)]),n("div",{class:"btn-group-vertical btn-group-sm"},[n("button",{class:"btn btn-success btn-sm",onClick:Te,title:"Save project (Ctrl+S)","data-bs-toggle":"tooltip"},[...a[1]||(a[1]=[n("i",{class:"bi bi-save"},null,-1)])]),n("button",{class:"btn btn-outline-secondary btn-sm",onClick:oe,title:"Exit to previous page","data-bs-toggle":"tooltip"},[...a[2]||(a[2]=[n("i",{class:"bi bi-x-circle"},null,-1)])])])])]),n("div",Kt,[C(xt,{"is-timing-mode":h.value,"timed-words":te.value.timedWords,"total-words":te.value.totalWords,"song-analysis":T.value,"timing-analysis":H.value,onToggleTimingMode:fe,onClearTiming:he,onApplyMusicalTiming:Fe,onResetSyllableTiming:$e,onAnalyzeTiming:Pe,onFixOverlaps:De},null,8,["is-timing-mode","timed-words","total-words","song-analysis","timing-analysis"]),C(Ft,{"timing-stats":te.value},null,8,["timing-stats"]),C(jt,{"viewport-width":Q.value,"current-breakpoint":ie.value},null,8,["viewport-width","current-breakpoint"]),C($t)])])]),n("div",Ht,[n("div",Ot,[n("div",Gt,[C(Me,{lyrics:c.value.lyrics,currentLine:f.value,currentWord:y.value,isTimingMode:h.value,onLineSelect:ue,onLyricsUpdate:me},null,8,["lyrics","currentLine","currentWord","isTimingMode"])]),n("div",Jt,[C(ia,{lyrics:c.value.lyrics,currentTime:ee.value.currentTime,currentLine:f.value,currentWord:y.value,currentSyllable:h.value?0:ee.value.currentSyllable?.syllableIndex},null,8,["lyrics","currentTime","currentLine","currentWord","currentSyllable"])])]),n("div",Xt,[n("div",Qt,[C(Oa,{audioFile:c.value.audioFile,lyrics:c.value.lyrics,currentTime:ee.value.currentTime,waveformData:x.value,playbackState:ee.value,isTimingMode:h.value,onSeek:pe,onLyricsPosition:xe,onPlayPause:ve,onSkipBackward:be,onSkipForward:ge,onViewWindowChange:re},{"above-waveform":A(()=>[(p(),L(_,{key:`timing-editor-${w.value}`,words:le.value,duration:se.value,"view-start":O.value,"view-end":J.value,"show-debug":!1,"onUpdate:words":Le,onSelectWord:Ee},null,8,["words","duration","view-start","view-end"]))]),_:1},8,["audioFile","lyrics","currentTime","waveformData","playbackState","isTimingMode"])])]),n("div",Zt,[n("div",Yt,[n("small",ei,[m(" ðŸŽ¯ "+r(h.value?"Timing":"Playback")+" Mode: Line "+r(f.value)+" , Word "+r(y.value+1)+" ",1),c.value.lyrics[f.value]?.words[y.value]?(p(),s("span",ai," ("+r(c.value.lyrics[f.value].words[y.value].word)+") ",1)):u("",!0),n("span",{class:o(["ms-3",ae.value?"text-success fw-bold":"text-muted"])}," ðŸ”„ "+r(ae.value?"12Hz FAST":"8Hz Normal"),3)])])])])])])):b.value?(p(),s("div",ti,[...a[3]||(a[3]=[n("div",{class:"text-center py-5"},[n("div",{class:"spinner-border text-primary",role:"status"},[n("span",{class:"visually-hidden"},"Loading...")]),n("p",{class:"mt-3"},"Loading project...")],-1)])])):(p(),s("div",ii,[n("div",li,[n("div",si,[n("div",ni,[a[5]||(a[5]=n("h3",null,"Project Not Found",-1)),a[6]||(a[6]=n("p",{class:"lead"},"The requested project could not be found.",-1)),C(t,{to:"/compose",class:"btn btn-primary"},{default:A(()=>[...a[4]||(a[4]=[n("i",{class:"bi bi-arrow-left"},null,-1),m(" Back to Projects ",-1)])]),_:1})])])])])),g.value?(p(),s("div",{key:3,class:o(["modal",{show:g.value}]),onClick:ne},[n("div",{class:"modal-dialog modal-lg",onClick:a[0]||(a[0]=F(()=>{},["stop"]))},[n("div",{class:"modal-content"},[n("div",{class:"modal-header"},[a[7]||(a[7]=n("h5",{class:"modal-title"},"ðŸŽ¹ Hotkey Reference Guide",-1)),n("button",{type:"button",class:"btn-close",onClick:ne})]),a[8]||(a[8]=S('<div class="modal-body" data-v-6a1b7887><div class="row" data-v-6a1b7887><div class="col-md-6" data-v-6a1b7887><h6 class="text-primary" data-v-6a1b7887>â¯ï¸ Playback Controls</h6><ul class="list-unstyled mb-4" data-v-6a1b7887><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>Spacebar</kbd> - Play/Pause (or Timing in Timing Mode)</li><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>Numpad Enter</kbd> - Play/Pause</li><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>Ctrl+P</kbd> - Play/Pause</li></ul><h6 class="text-success" data-v-6a1b7887>â© Navigation</h6><ul class="list-unstyled mb-4" data-v-6a1b7887><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>Home</kbd> - Jump to start (0:00)</li><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>End</kbd> - Jump to end of song</li><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>Numpad +</kbd> - Skip forward 1 second</li><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>Numpad -</kbd> - Skip backward 1 second</li><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>Ctrl+R</kbd> - Skip forward 10 seconds</li><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>Ctrl+L</kbd> - Skip backward 10 seconds</li></ul></div><div class="col-md-6" data-v-6a1b7887><h6 class="text-warning" data-v-6a1b7887>â±ï¸ Timing Assignment</h6><ul class="list-unstyled mb-4" data-v-6a1b7887><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>Spacebar</kbd> - Assign timing (in Timing Mode)</li><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>Numpad 0</kbd> or <kbd data-v-6a1b7887>.</kbd> - Assign timing</li><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>T</kbd> or <kbd data-v-6a1b7887>Insert</kbd> - Toggle Timing Mode</li></ul><h6 class="text-info" data-v-6a1b7887>ðŸ“ Editing</h6><ul class="list-unstyled mb-4" data-v-6a1b7887><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>Ctrl+S</kbd> - Save project</li><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>Escape</kbd> - Close modal or exit timing mode</li><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>Double-click</kbd> any lyric line to edit</li><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>Enter</kbd> or <kbd data-v-6a1b7887>Blur</kbd> to save</li><li class="mb-2" data-v-6a1b7887><kbd data-v-6a1b7887>Escape</kbd> to cancel</li></ul></div></div><div class="alert alert-info mt-3" data-v-6a1b7887><strong data-v-6a1b7887>ðŸ’¡ Pro Tips:</strong><ul class="mb-0 mt-2" data-v-6a1b7887><li data-v-6a1b7887>Use <kbd data-v-6a1b7887>Home</kbd>/<kbd data-v-6a1b7887>End</kbd> for instant navigation to start/end</li><li data-v-6a1b7887>Use the numpad for fastest timing assignment workflow</li><li data-v-6a1b7887>Toggle Timing Mode (<kbd data-v-6a1b7887>T</kbd> or <kbd data-v-6a1b7887>Insert</kbd>) to focus on timing vs playback</li><li data-v-6a1b7887>Double-click lyrics for quick inline editing</li><li data-v-6a1b7887>Use 1-second skips for precise timing adjustments</li></ul></div></div>',1)),n("div",{class:"modal-footer"},[n("button",{type:"button",class:"btn btn-primary",onClick:ne},"Got it!")])])])],2)):u("",!0)],512)}}}),[["__scopeId","data-v-6a1b7887"]]))}}});
//# sourceMappingURL=TimingView-legacy-88236cdb.js.map
